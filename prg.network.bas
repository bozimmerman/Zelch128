!--------------------------------------------------
!- Saturday, August 13, 2016 1:47:09 PM
!- Import of : 
!- c:\tmp\newproject\prg.network.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM ============== NETWORK MODULE V2.2 ============== 12/07/91 =
30010 IFW1=.1THEN50000:ELSEIFW1=.2THEN51000
30015 ON(W1-700)GOTO31000,32000,33000,34000,35000:GOTO920
30020 I$="":TI$="000000"
30030 GET#5,A$:IFVAL(TI$)>30THEN50090:ELSEIFA$=""THEN30030
30040 IFA$=R$ORLEN(I$)>50THENRETURN:ELSEI$=I$+A$:GOTO30030
30060 O$=T$(119):GOSUB4:X=1:GOSUB5:IFI$=""THENI=0:RETURN:ELSEI=VAL(I$):IFI>0ANDI<27THEN30070
30065 I=ASC(I$)-192:IFI<1ORI>26THENI=0:RETURN
30070 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.network":RECORD#2,I:SYS8222:IFLEN(I$)<2THENCLOSE2:I=0:RETURN:ELSESYS8222:SYS8222:SY$(4)=I$
30080 SYS8222:W1$=I$:RECORD#2,27:FORX=1TO3:SYS8222:NEXTX:CLOSE2:W2$=I$:RETURN
30100 GOSUB990:E=0:IFSY$<>"*"THENI$=SY$:RETURN:ELSEO$=T$(120):GOSUB4:X=16:GOSUB16:IFI$=""ORVAL(I$)THENE=1:RETURN:ELSERETURN
30110 GOSUB760:W9=0:IFI>0ANDI<27THEN30070:ELSEIFSY$="+"THENW9=1:I=1:RETURN:ELSE30060
30200 O$="{black}"+O$+": {white}"+VT$(A):GOSUB4:IFVT$(A)<>""THENC$=CHR$(20):GOSUB32:IFI=2THENO$=R$:GOSUB9:GOTO30275
30210 IFVT$(A)<>""THENFORX=1TOVT(A):O$=CHR$(20):GOSUB9:NEXT
30220 X=L:GOSUB5:IFI$<>""THENVT$(A)=I$:VT(A)=LEN(I$)
30275 I=VAL(VT$(A)):RETURN
30999 REM ------- NET EMAIL
31000 GOSUB400:GOSUB30110:IFI=0THEN920:ELSEGOSUB30100:IFETHEN920:ELSEF$="net."+MID$(W1$,2):U=D(5,0):D=D(5,1):IFW9THENF$="net.misc"
31010 O$(5)=MID$(SY$(4),2)+R$+MID$(W2$,2)+R$+"1"+I$+R$+U$(1)+R$+STR$(ID)+R$+O$(3):GOSUB8125:IFO(11)THEN920:ELSE940
31999 REM ------- NET FEEDBACK
32000 GOSUB400:GOSUB30110:IFI=0THEN920:ELSEF$="net."+MID$(W1$,2):U=D(5,0):D=D(5,1):IFW9THENF$="net.misc"
32010 O$(5)=MID$(SY$(4),2)+R$+MID$(W2$,2)+R$+"2"+R$+U$(1)+R$+STR$(ID)+R$+O$(3):GOSUB8125:IFO(11)THEN920:ELSE940
32999 REM ------- LIST NETWORKS
33000 W1=1:GOSUB760:W3$="":IFI>0ANDI<27THENW1=I:W3$="#"
33005 W2=26:GOSUB760:IFI>W1ANDI<27THENW2=I
33010 O$="":GOSUB4:OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.network":X=W1-1:DO
33020 X=X+1:RECORD#2,X:SYS8222:IFLEN(I$)<2THEN33050:ELSEW1$=I$:SYS8222:SYS8222
33030 A$=CHR$(192+X):IFW3$="#"THENA$=RIGHT$(STR$(X),2)
33040 O$="{black}"+A$+") "+W1$+LEFT$(SP$,22-LEN(W1$))+I$:GOSUB4
33050 GOSUB8:IFA$=" "ORI$="{pound}"THENEXIT
33060 LOOPUNTILX>=W2:CLOSE2
33070 IFA$=" "THEN920:ELSE940
33999 REM ------- EDIT NETWORKS
34000 GOSUB760:IFSY$="*"THENO$=T$(119):GOSUB4:X=1:GOSUB5:I=ASC(I$+CHR$(0))-192:ELSEIFSY$="+"THENI=27
34010 IFI<1ORI>26THEN920:ELSEOPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.network":RECORD#2,I:FORI=1TO7:SYS8222:VT$(I)=I$:VT(I)=LEN(I$):NEXTI:CLOSE2
34020 A=1:L=16:O$="System name      ":GOSUB30200:A=2:L=8:O$="System password  ":GOSUB30200:O$="Actual number:":GOSUB4:A=3:GOSUB34500:IFI=27THEN34100
34030 O$="Network number   ":GOSUB4:A=4:GOSUB34500:A=5:L=4:W2$=MID$("NY",VAL(RIGHT$(VT$(A),1))+1,1):VT$(6)=MID$("NY",VAL(LEFT$(W1$,1))+1,1)
34040 VT$(A)=STR$(VAL(VT$(A))*300):VT(A)=LEN(VT$(A)):O$="Baud rate        ":GOSUB30200:VT$(A)=MID$(STR$(VAL(VT$(A))/300),2):IFINSTR("128",VT$(A))=0THEN34040
34050 A=6:L=1:VT(A)=1:O$="Receive news Y/N ":GOSUB30200:IFINSTR("NY",VT$(A))=0THEN34050:ELSEW1$=VT$(6):VT$(6)=W2$
34060 A=6:L=1:O$="Send news to Y/N ":GOSUB30200:IFINSTR("NY",VT$(A))=0THEN34050:ELSEVT$(6)=MID$(STR$(INSTR("NY",W1$)-1),2)+MID$(STR$(INSTR("NY",VT$(A))-1),2)
34070 O$="{black}Mbases:":SY$=VT$(7):E=0:GOSUB610:VT$(7)=SY$
34500 W1$=VT$(A):VT$(A)=LEFT$(VT$(A),3):VT(A)=3:O$="Area code (XXX)  ":L=3:GOSUB30200:IFI<100ORI>999THEN34500:ELSEW3$=VT$(A)
34510 VT$(A)=RIGHT$(W1$,                        O$="Phone (XXXYYYY)  ":L=7:GOSUB30200:IFLEN(I$)<>7ORINSTR(I$,"-")THEN34510:ELSEW2$=I$
34520 O$="{black}Is this a local call (y/n)? {white}{ct c}":GOSUB4:C$="YN":GOSUB28:W1$=MID$("L1",I,1)+MID$(STR$(A),2)+W2$:RETURN
34999 REM ------- ADD A NETWORK
35000 GOSUB30110:IFI=0THEN920:ELSEOPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.network":O$="{ct k}Deleting "+SY$(4):GOSUB4
35010 RECORD#2,I:PRINT#2,"^"+R$+"{ct c}"+R$+" 0000000000"+R$+" 0000000000"+R$+"1"+R$+"00"+R$+"00000000000000000000000000":CLOSE2:GOTO940
50000 REM ----------- NETWORK RECEIVE ROUTINES
50001 DO:GET#5,A$:LOOPUNTILA$="":O(19)=1:O$(23)=PR$(1,0):BLOAD(PR$(1,1)),U(D(0,0)),D(D(0,1)):GOSUB51310:Y=1:PRINT#5,"GGGGGG";
50005 GOSUB30020:W1$=I$
50010 W1=0:DO:W1=W1+1:LOOPUNTILW1>26ORW1$=M$(W1,1):IFW1>26THENPRINT#5,"BBBBBB";:Y=Y+1:IFY<5THEN50005
50020 IFY>4THEN50090:ELSEPRINT"{clear}";:O$="Networking with "+M$(W1,2):GOSUB250
50022 U=D(1,0):D=D(1,1):OPEN1,U,15:OPEN2,U,2,MID$(STR$(D),2)+":sys.userlog,s,w":INPUT#1,E:IFETHENCLOSE2:OPEN2,U,2,MID$(STR$(D),2)+":sys.userlog,s,a"
50025 PRINT#2,"{reverse on}{light blue}NETWORKED WITH "+M$(W1,2)+R$:CLOSE2:CLOSE1
50030 PRINT#5,"GGGGGGGG";:U=D(5,0):D=D(5,1):F$="net."+MID$(M$(27,2),2):GOSUB590:SYS4885:SYS4873:IFPEEK(512)=1THEN50090
50040 OPEN1,U,15:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,a":PRINT#2,"{ct a}":INPUT#1,E:IFE>19THENCLOSE2:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,w"
50050 SLEEP1:SYS59074:SYS4885:SYS4867:SLEEP1:POKE2585,PEEK(2584):CLOSE2
50060 IFPEEK(215)THENFAST
50070 F$="net."+MID$(M$(W1,2),2):SLEEP7:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,r":INPUT#1,E:CLOSE2:CLOSE1:IFETHENPRINT#5,"BBBBBBBBBB";:GOTO50090
50080 PRINT#5,"GGGGGGG";:I=2:SLEEP1:GOSUB550:OPEN1,U,15,"s"+MID$(STR$(D),2)+":"+F$:CLOSE1
50090 GOSUB52930:GOSUB13:GOSUB52000:I$="prg.logon":U=D(0,0):D=D(0,1):GOTO23
50100 GOSUB52930:GOSUB13:GOSUB52000:I$="prg.monster":U=D(0,0):D=D(0,1):GOTO23
51000 REM ----------- NETWORK CALL ROUTINES
51010 MB(5)=0:O(19)=1:BLOAD(PR$(1,1)),U(D(0,0)),D(D(0,1)):O$(23)=PR$(1,0):A$="e0":GOSUB2:GOSUB51310:O$="Rummaging through files...":GOSUB250
51020 SY(1)=-1:GOSUB51500:SY(1)=-1:GOSUB51700:SY(1)=-1:GOSUB51900
51040 MB(5)=MB(5)+1:IFMB(5)>26THEN50100
51050 IFM$(MB(5),3)<>M$(MB(5),2)ORLEN(M$(MB(5),0))<3THEN51040:ELSEW9$=M$(MB(5),3):IFLEFT$(W9$,1)="L"THENW9$=RIGHT$(M$(MB(5),3),7)
51060 CLOSE2:CLOSE1:OPEN1,D(5,0),15:OPEN2,D(5,0),2,MID$(STR$(D(5,1)),2)+":net."+MID$(M$(MB(5),3),2)+",s,r":INPUT#1,E:CLOSE1:CLOSE2:IFETHEN51040
51070 O$="Snarling with "+W9$:GOSUB250
51080 Y=0:I=VAL(M$(MB(5),4))*300:IFI<>BATHENGOSUB450:Y=0
51090 PRINT#5,R$R$:SLEEP2:TI$="000000"
51100 GET#5,A$:IFA$<>""THEN51100
51110 PRINT#5,"atdt"+W9$:I$=""
51120 GET#5,A$:IFVAL(TI$)>30THENI$="6":GOTO51150
51130 IFA$=""THEN51120
51140 IFA$<>CHR$(13)THENI$=I$+A$:GOTO51120
51150 IFI$=""THEN51120:ELSEA$="":FORI=1TOLEN(I$):W2=ASC(MID$(I$,I,1))AND127:IFW2>47ANDW2<58THENA$=A$+CHR$(W2)
51160 NEXTI:I$=A$:IFI$=""THEN51120
51170 A=VAL(I$):IFA=1ORA=5ORA=10THEN51200
51180 IFINSTR(I$,"dt")THENI$="":GOTO51120
51190 IFY=0THENY=1:GOTO51090:ELSEGOSUB13:GOTO51040
51200 SLEEP7:DO:GET#5,A$:LOOPUNTILA$="":PRINT#5,"ZZZZZ";:GOSUB51280:IFE>1THENGOSUB13:GOTO51040
51210 SLEEP2:FORI=1TOLEN(M$(27,1)):PRINT#5,MID$(M$(27,1),I,1);:FORX=1TO50:NEXTX:NEXTI:PRINT#5,R$;:GOSUB51280:ONEGOTO51220,51210,51040
51220 P0$(P0)="Snarled with "+W9$:P0=P0+1:U=D(5,0):D=D(5,1):F$="net."+MID$(M$(MB(5),3),2):I=2:GOSUB550:OPEN1,U,15,"s"+MID$(STR$(D),2)+":"+F$:CLOSE1:GOSUB51280
51230 IFE>1THENGOSUB13:GOTO51040:ELSEF$="net."+MID$(M$(27,2),2)
51240 GOSUB590:SYS4885:SYS4873:IFPEEK(512)=1THENGOSUB13:GOTO51040
51250 OPEN1,U,15:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,a":PRINT#2,"{ct a}":INPUT#1,E:IFETHENCLOSE2:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,w"
51260 SLEEP1:SYS59074:SYS4885:SYS4867:SLEEP1:POKE2585,PEEK(2584):CLOSE2
51270 CLOSE1:GOSUB13:IFPEEK(215)THENFAST:GOTO51040:ELSE51040
51280 TI$="000000":DO:GET#5,A$:IFA$<>""THENA$=CHR$(ASC(A$)OR128)
51290 E=INSTR("GB",A$):LOOPUNTIL(E)ORVAL(TI$)>30:IFETHENDO:GET#5,A$:LOOPUNTILA$="":RETURN:ELSEE=3:GOTO13
51300 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.network":RETURN
51310 GOSUB51300:FORX=1TO27:RECORD#2,X:FORY=0TO6:SYS8222:M$(X,Y)=I$:NEXTY:NEXTX:CLOSE2:RETURN
51500 SY(1)=SY(1)+1:GOSUB51590:IFETHENCLOSE2:CLOSE1:RETURN
51510 SYS8222:W1$=I$:SYS8222:W2$=I$:SYS8222:W3$=I$:IFPEEK(253)THENCLOSE2:PRINT#1,"s"+MID$(STR$(D(5,1)),2)+":net.msg bases":CLOSE1:RETURN
51520 L=0:FORI=1TO26:IFLEN(M$(I,0))>2ANDMID$(M$(I,6),ASC(W1$)-192,1)="1"THENL=L+1:MN$(L)=MID$(M$(I,2),2)
51530 NEXTI:IFL=0THEN51500
51540 GOSUB52950:FORX=1TO26:IFVT$(X)=""THEN51580
51550 F$="net."+MID$(M$(X,2),2):U=D(5,0):D=D(5,1):O$(5)=VT$(X)+R$+MID$(M$(27,2),2)+R$+MID$(STR$(VAL(W2$)+3),2)+W1$+W3$:GOSUB52900
51570 GOSUB51590:SYS8222:SYS8222:SYS8222
51580 NEXTX:GOTO51500
51590 CLOSE2:CLOSE1:OPEN1,D(5,0),15:OPEN2,D(5,0),2,MID$(STR$(D(5,1)),2)+":net.msg bases,s,r":INPUT#1,E:IFSY(1)THENFORI=1TOSY(1):SYS8213:NEXT:RETURN:ELSERETURN
51700 SY(1)=SY(1)+1:GOSUB51790:IFETHENRETURN
51710 SYS8222:W1$=I$:IFPEEK(253)THENCLOSE2:PRINT#1,"s"+MID$(STR$(D(5,1)),2)+":net.newsfiles":CLOSE1:RETURN
51720 L=0:FORI=1TO26:IFLEN(M$(I,0))>2ANDMID$(M$(I,5),2,1)="1"THENL=L+1:MN$(L)=MID$(M$(I,2),2)
51730 NEXTI:IFL=0THEN51700
51740 GOSUB52950:FORX=1TO26:IFVT$(X)=""THEN51780
51750 F$="net."+MID$(M$(X,2),2):U=D(5,0):D=D(5,1):O$(5)=VT$(X)+R$+MID$(M$(27,2),2)+R$+"5"+R$+W1$:GOSUB52900:GOSUB51790:SYS8222
51780 NEXTX:GOTO51700
51790 CLOSE2:CLOSE1:OPEN1,D(5,0),15:OPEN2,D(5,0),2,MID$(STR$(D(5,1)),2)+":net.newsfiles,s,r":INPUT#1,E:IFSY(1)THENFORI=1TOSY(1):SYS8213:NEXT:RETURN:ELSERETURN
51900 SY(1)=SY(1)+1:GOSUB51990:IFETHENRETURN
51910 SYS8222:W1$=I$:SYS8222:W2$=I$:SYS8222:W3$=I$:IFPEEK(253)THENCLOSE2:PRINT#1,"s"+MID$(STR$(D(5,1)),2)+":net.misc":CLOSE1:RETURN
51920 L=0:FORI=1TO26:IFLEN(M$(I,0))>2THENL=L+1:MN$(L)=MID$(M$(I,2),2)
51930 NEXTI:IFL=0THEN51900
51940 GOSUB52950:FORX=1TO26:IFVT$(X)=""THEN51980
51950 F$="net."+MID$(M$(X,2),2):U=D(5,0):D=D(5,1):O$(5)=VT$(X)+R$+MID$(M$(27,2),2)+R$+W3$:GOSUB52900:GOSUB51990:SYS8222:SYS8222:SYS8222
51980 NEXTX:GOTO51900
51990 CLOSE2:CLOSE1:OPEN1,D(5,0),15:OPEN2,D(5,0),2,MID$(STR$(D(5,1)),2)+":net.misc,s,r":INPUT#1,E:IFSY(1)THENFORI=1TOSY(1):SYS8213:NEXT:RETURN:ELSERETURN
52000 REM ----------- UNPACK NETWORK FILES
52010 GOSUB51310
52020 GOSUB400:O$="Hurling files about...":GOSUB250:SY(2)=0
52030 SY(2)=SY(2)+1:GOSUB52170:IFETHEN52930
52050 SYS8222:W1$=I$:SYS8222:W2$=I$:SYS8222:W3$=I$:SY(1)=0:DO:SY(1)=SY(1)+1:LOOPUNTILW2$=MID$(M$(SY(1),2),2)ORSY(1)>26:IFPEEK(253)THEN52530
52060 FORI=1TO27:MN$(I)="":NEXTI:L=0:DO:L=L+1:MN$(L)=LEFT$(W1$,10):W1$=RIGHT$(W1$,LEN(W1$)-10)
52070 LOOPUNTILW1$="":GOSUB52950
52110 FORX=1TO26:IFVT$(X)=""THEN52150
52120 F$="net."+MID$(M$(X,2),2):U=D(5,0):D=D(5,1):O$(5)=VT$(X)+R$+W2$+R$+W3$:GOSUB52900:GOSUB52170:SYS8222:SYS8222:SYS8222
52150 NEXTX:IFVT$(27)>""THENONVAL(LEFT$(W3$,1))GOSUB52500,52520,52300,52600,52200
52160 CLOSE2:CLOSE1:CLOSE15:CLOSE3:GOTO52030
52170 CLOSE2:CLOSE1:OPEN1,D(5,0),15:OPEN2,D(5,0),2,MID$(STR$(D(5,1)),2)+":net."+MID$(M$(27,2),2)+",s,r":INPUT#1,E:IFSY(2)>1THENFORI=2TOSY(2):SYS8213:NEXT
52180 RETURN
52200 SYS8222:X=VAL(I$):SYS8222:Y=VAL(I$):GOSUB400:I=X:GOSUB52250:O$(5)=I$+R$:I=Y:GOSUB52250:O$(5)=O$(5)+I$+R$+M$(SY(1),0)+"/"+W2$+R$+O$(24)
52210 IFMID$(M$(SY(1),5),1,1)="1"THENU=D(1,0):D=D(1,1):F$="sys.news":GOTO52900:ELSECLOSE2:CLOSE1:RETURN
52220 U=D(1,0):D=D(1,1):F$="sys.news":GOTO52900
52250 W1=VAL(MID$(O$(2),1,2)):W2=VAL(MID$(O$(2),3,2)):W3=VAL(MID$(O$(2),5,2)):IFI=0THEN52290
52260 FORW4=1TOI:W3=W3+1:IFW3>PEEK(2880+W2)THENW3=1:W2=W2+1:IFW2>12THENW2=1:W1=W1+1
52270 NEXTW4
52290 I$=RIGHT$(STR$(W1),2)+RIGHT$(STR$(W2),2)+RIGHT$(STR$(W3),2)+"9999":DO:I=INSTR(I$," "):IFITHENMID$(I$,I,1)="0"
52295 LOOPUNTILI=0:RETURN
52300 CLOSE2:CLOSE1:MB(1)=ASC(MID$(W3$,2,1))-192:IFMB(1)<1ORMB(1)>26THENRETURN:ELSEGOSUB52800:IFMB(1)=0THENRETURN
52310 F$="msg."+CHR$(MB(1)+192)+STR$(MB(4)):U=D(7,0):D=D(7,1):OPEN1,U,15,"s"+MID$(STR$(D),2)+":"+F$:CLOSE1:GOSUB52170:SYS8222:SYS8222:SYS8222
52320 O$(5)="":FORI=1TO4:SYS8222:O$(5)=O$(5)+I$+R$:NEXTI:O$(5)=O$(5)+"#"+M$(SY(1),0)+"/{f4}"+W2$:GOSUB52900:GOSUB400
52330 X=MB(4):MB(4)=MB(4)+1:IFMB(4)>MB(2)THENMB(4)=1:MB(3)=MB(2)
52340 MB(3)=MB(3)+1:IFMB(3)>MB(2)THENMB(3)=MB(2)
52350 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.mdata":RECORD#2,((MB(1)-1)*51)+X:PRINT#2,O$(2)+R$+"0"
52355 RECORD#2,MB(1)*51:PRINT#2,STR$(MB(3))+R$+STR$(MB(4)):CLOSE2
52360 RETURN
52500 W3$=MID$(W3$,2):A=0:FORX=1TOLEN(W3$):C=A:A=ASC(MID$(W3$,X,1)):IFA>64ANDA<91AND(O(25)=0)THENA=AOR128:GOTO52505
52503 IFA>192ANDA<219ANDC>192ANDC<219ANDO(25)=1THENA=AAND127
52505 MID$(W3$,X,1)=CHR$(A):NEXTX
52507 X=0:DO:X=X+1:LOOPUNTILUI$(X)=W3$ORX>499ORUI$(X)="":IFUI$(X)<>W3$THEN52560
52510 U=D(5,0):D=D(5,1):F$="mail."+STR$(X):O$(5)="#"+M$(SY(1),0)+"/{f4}"+W2$:GOTO52900
52520 U=D(6,0):D=D(6,1):F$="sys.feedback":O$(5)="#"+M$(SY(1),0)+"/{f4}"+W2$:O(2)=O(2)+1:GOTO52900
52530 CLOSE2:PRINT#1,"s"+MID$(STR$(D(5,1)),2)+":net."+MID$(M$(27,2),2):GOTO52930
52560 U=D(5,0):D=D(5,1):SYS8222:X=0:DO:X=X+1:LOOPUNTILMID$(M$(X,2),2)=W2$ORX>26:F$="net."+MID$(M$(X,3),2):IFX>26THENCLOSE2:RETURN
52570 W1$=MID$(M$(27,2),2):OPEN3,U,3,MID$(STR$(D),2)+":"+F$+",s,w":INPUT#1,E:IFETHENCLOSE3:OPEN3,U,3,MID$(STR$(D),2)+":"+F$+",s,a":PRINT#3,"{ct a}"
52580 PRINT#3,W2$+R$+W1$+R$+"1"+I$+R$+"ZELCH MONSTER"+R$+" 0"+R$+O$(3)+R$+R$+"{black}{ct k}Sorry, {f5}"+W3$+"{f5} was not{f7}found at "+W1$+".{ct k*2}Possibilities include:"
52590 X=0:DO:X=X+1:IFLEFT$(UI$(X),1)=LEFT$(W3$,1)THENPRINT#3,"{f5}"+UI$(X)+"{f5}"
52595 LOOPUNTILX>500ORUI$(X)="":CLOSE3:CLOSE2:RETURN
52600 CLOSE2:CLOSE1:MB(1)=ASC(MID$(W3$,2,1))-192:IFMB(1)<1ORMB(1)>26THENRETURN:ELSEGOSUB52800:IFMB(1)=0THENRETURN
52610 U=D(7,0):D=D(7,1):W3$=MID$(W3$,3):Y=0:GOSUB400:FORX=1TOMB(3)
52620 IFY=0THENOPEN2,U,2,MID$(STR$(D),2)+":msg."+CHR$(192+MB(1))+STR$(X)+",s,r":SYS8222:SYS8222:SYS8222:IFI$=W3$THENY=X
52630 CLOSE2:NEXTX:IFY=0THENRETURN:ELSEF$="msg."+CHR$(192+MB(1))+STR$(Y):GOSUB52170
52635 FORI=1TO3:SYS8222:NEXT:O$(5)="":SYS8222:FORI=1TO3:SYS8222:O$(5)=O$(5)+I$+R$:NEXT
52640 O$(5)=O$(2)+R$+O$(5)+"#"+M$(SY(1),0)+"/{f4}"+W2$:GOSUB52900
52650 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.mdata":RECORD#2,((MB(1)-1)*51)+Y:PRINT#2,O$(2)+R$+STR$(MR(Y)+1):CLOSE2:RETURN
52800 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.mbases":RECORD#2,MB(1):INPUT#2,D(7,0),D(7,1):INPUT#2,MB(2)
52805 FORI=4TO7:SYS8222:NEXT:IFVAL(I$)=0THENMB(1)=0:GOTO52820
52810 FORI=8TO11:SYS8222:NEXT:IFI$<>"Y"ORMID$(M$(SY(1),6),MB(1),1)<>"1"THENMB(1)=0
52820 CLOSE2:IFMB(1)=0THENRETURN
52830 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.mdata":RECORD#2,MB(1)*51:INPUT#2,MB(3),MB(4)
52835 IFMB(3)THENFORI=1TOMB(3):RECORD#2,((MB(1)-1)*51)+I:INPUT#2,MN$(I),MR(I):NEXTI
52840 CLOSE2:RETURN
52900 OPEN15,U,15:OPEN3,U,3,MID$(STR$(D),2)+":"+F$+",s,w":INPUT#15,E
52910 IFETHENCLOSE3:OPEN3,U,3,MID$(STR$(D),2)+":"+F$+",s,a":PRINT#3,CHR$(1)
52920 PRINT#3,O$(5):GOSUB31:CLOSE3:CLOSE2:CLOSE15:CLOSE1:RETURN
52930 CLOSE2:CLOSE3:CLOSE1:CLOSE15:FORX=0TO50:MN$(X)="":VT$(X)="":FORY=0TO6:M$(X,Y)="":NEXTY:NEXTX:X=FRE(1):RETURN
52950 FORI=1TO27:VT$(I)="":NEXTI:FORX=1TOL
52960 I=0:DO:I=I+1:LOOPUNTILI>27ORMN$(X)=MID$(M$(I,2),2):IFI>27THEN52990:ELSEW4$=MID$(M$(I,3),2):IFI=27THENC=I:GOTO52980
52970 C=0:DO:C=C+1:LOOPUNTILI>26ORW4$=MID$(M$(C,2),2):IFI>26THEN52990
52980 VT$(C)=VT$(C)+MN$(X)
52990 NEXTX:RETURN
55555 U=PEEK(186):OPEN1,U,15,"s"+MID$(STR$(D),2)+":prg.network":CLOSE1:DSAVE"prg.network",U(U),D(0):STOP
