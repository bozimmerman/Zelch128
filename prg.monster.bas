!--------------------------------------------------
!- Monday, May 15, 2017 12:17:16 AM
!- Import of : 
!- c:\src\zelch128\prg.monster.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM ============ MIDNIGHT MONSTER MODE ============== 12/14/90 =
30010 PRINT"{clear}{ct n}{down}{reverse on}{light green}Monster Mode{down*3}"+R$+"user weed...";:GOSUB18
30100 GOSUB400:OPEN1,D(5,0),15,"i"+STR$(D(5,1)):OPEN2,D(1,0),2,STR$(D(1,1))+":sys.userfiles":P0=1:W1=1:W5=0
30200 W2=VAL(MID$(O$(2),5,2)):W3=VAL(MID$(O$(2),3,2)):W4=VAL(LEFT$(O$(2),2)):FORI=1TOM(13)
30300 W2=W2-1:IFW2<1THENW3=W3-1:W2=PEEK(2880+W3):IFW3<1THENW3=12:W2=31:W4=W4-1:IFW4<0THENW4=99
30400 NEXTI:W1$=RIGHT$(STR$(W4),2)+RIGHT$(STR$(W3),2)+RIGHT$(STR$(W2),2):DO:W7=INSTR(W1$," "):IFW7>0THENMID$(W1$,W7,1)="0"
30500 LOOPUNTILW7=0
30600 O$="Checking users":GOSUB250:I=FRE(1)
30700 IFUI$(W1)="^"THENPRINT#1,"s"+STR$(D(5,1))+":mail."+STR$(W1):W1=W1+1:GOTO30700
30800 IFUI$(W1)=""ORUI$(W1)="{pound}"ORW1>500THENCLOSE2:CLOSE1:O$="Updating newsfiles":GOSUB250:PRINTR$+"{down*2}{light green}newsfiles...";:GOTO31200
30900 RECORD#2,W1:FORI=1TO6:SYS8222:NEXTI:A$=I$:SYS8222:SYS8222:IFLEFT$(A$,6)>W1$ORMID$(I$,3,1)="1"THENW1=W1+1:GOTO30700
31000 O$="Munching user":GOSUB250:RECORD#2,W1:PRINT#2,"^"+R$+"{f4}"+R$+"^"+R$+"(xxx)/xxx-xxxx"+R$+"A"+R$+"^"+R$+"^"+R$+"000"+R$+" 0"+R$+" 0"+R$+" 0"+R$+" 0"
31100 PRINT#1,"s"+STR$(D(5,1))+":mail."+STR$(W1):P0$(P0)="Munched user #"+STR$(W1)+"/"+UI$(W1):UI$(W1)="^":P0=P0+1:W1=W1+1:GOTO30600
31200 X=0:U=D(1,0):D=D(1,1):OPEN1,U,15:OPEN2,U,2,STR$(D)+":sys.news,s,r":INPUT#1,E:IFE>0THEN31700
31210 SYS8222:SYS8222:IFPEEK(253)THEN31900
31220 IFI$>O$(2)THENSYS8213:GOTO31210
31290 CLOSE1:CLOSE2:OPEN1,U,15,"s"+STR$(D)+":sys.work":OPEN2,U,2,STR$(D)+":sys.news,s,r":X=0
31300 OPEN3,U,3,STR$(D)+":sys.work,s,w"
31400 SYS8222:A$=I$:SYS8222:IFPEEK(253)THEN31700
31500 IFI$<=O$(2)THENSYS8213:P0$(P0)="Stomped newsfile #"+STR$(X+1):P0=P0+1:GOTO31400
31550 IFX>0THENPRINT#3,CHR$(1)
31600 PRINT#3,A$:PRINT#3,I$:GOSUB31:X=X+1:GOTO31400
31700 CLOSE2:CLOSE3:IFX=0THENPRINT#1,"s"+STR$(D)+":sys.work":PRINT#1,"s"+STR$(D)+":sys.news":CLOSE1:GOTO31900
31800 PRINT#1,"s"+STR$(D)+":sys.news":PRINT#1,"r"+STR$(D)+":sys.news=sys.work":CLOSE1:GOTO31900
31900 W1=1:PRINT"{down*2}"+R$+"message bases...";:CLOSE2:CLOSE3:CLOSE1
32000 IFW1>20THEN33400:ELSEOPEN2,D(1,0),2,STR$(D(1,1))+":sys.msg bases":RECORD#2,W1:INPUT#2,U:INPUT#2,D:FORI=1TO5:SYS8222:TT$(I)=I$:NEXTI:CLOSE2:I=FRE(1)
32100 O$="Sniffing sig "+CHR$(192+W1):GOSUB250
32200 IFTT$(4)="{pound}"ORVAL(TT$(5))=0THENW1=W1+1:GOTO32000
32300 OPEN2,D(1,0),2,STR$(D(1,1))+":sys.msg data":RECORD#2,((W1-1)*51)+51:INPUT#2,W2:FORI=1TOW2:RECORD#2,((W1-1)*51)+I:SYS8222:MN$(I)=I$:INPUT#2,MR(I)
32400 NEXTI:CLOSE2:FORI=1TOW2:IFMR(I)<VAL(TT$(2))THEN33300
32500 O$="Chewing msg "+CHR$(192+W1)+" #"+STR$(I):GOSUB250:OPEN1,U,15,"s"+STR$(D)+":sys.work":OPEN2,U,2,STR$(D)+":msg."+CHR$(64+W1)+STR$(I)+",s,r"
32600 INPUT#1,E:IFE>0THENCLOSE1:CLOSE2:MN$(I)="0":MR(I)=0:GOTO33200
32700 OPEN3,U,3,STR$(D)+":sys.work,s,w":P0$(P0)="Chewed message "+CHR$(192+W1)+"  #"+STR$(I):P0=P0+1
32800 SYS8222:IFI$<>CHR$(1)THENPRINT#3,I$:GOTO32800
32900 PRINT#3,I$:FORX=1TOMR(I)-VAL(TT$(3)):SYS8213:MR(I)=MR(I)-1:NEXTX
33000 SYS8222:IFPEEK(253)=0THENPRINT#3,I$:GOTO33000
33100 PRINT#3,I$:CLOSE3:CLOSE2:PRINT#1,"s"+STR$(D)+":msg."+CHR$(64+W1)+STR$(I):PRINT#1,"r"+STR$(D)+":msg."+CHR$(64+W1)+STR$(I)+"=sys.work":CLOSE1
33200 OPEN2,D(1,0),2,STR$(D(1,1))+":sys.msg data":RECORD#2,((W1-1)*51)+I:PRINT#2,MN$(I)+CHR$(13)+STR$(MR(I)):CLOSE2:O$="Burp!":GOSUB250
33300 NEXTI:W1=W1+1:GOTO32000
33400 CLOSE1:CLOSE2:CLOSE3:PRINTR$+"{down*2}{light green}validation...":OPEN2,D(1,0),2,STR$(D(1,1))+":sys.drives,s,r":O$="Growls..":GOSUB250:X=0
33500 DO:SYS8222:IFI$=""THENCLOSE2:CLOSE1:EXIT
33600 IFVAL(I$)<8THENCLOSE2:CLOSE1:EXIT
33700 TT$(X)=I$:X=X+1:LOOP:FORI=0TOX-1:OPEN1,VAL(TT$(I)),15,"v"+RIGHT$(TT$(I),1):CLOSE1:NEXTI
33800 OPEN1,D(1,0),15:OPEN2,D(1,0),2,STR$(D(1,1))+":sys.userlog,s,a":INPUT#1,E:IFE>0THENCLOSE2:OPEN2,D(1,0),2,STR$(D(1,1))+":sys.userlog,s,w"
33900 PRINT#2,"{reverse on}{light green}MONSTER{sh space}MODE{sh space}REPORT: ";:IFP0=1THENPRINT#2,"GROWL!":CLOSE2:CLOSE1:GOTO34100
34000 PRINT#2:FORI=1TOP0-1:PRINT#2,P0$(I):P0$(I)="":NEXTI:CLOSE2:CLOSE1
34100 FORI=0TO51:TT$(I)="":NEXTI:I=FRE(1):I$="prg.logon":U=D(0,0):D=D(0,1):GOTO23
55555 OPEN1,8,15,"s0:prg.monster":CLOSE1:DSAVE"prg.monster"
