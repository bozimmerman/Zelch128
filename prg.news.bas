!--------------------------------------------------
!- Monday, May 15, 2017 3:03:27 AM
!- Import of : 
!- c:\src\zelch128\prg.news.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM ============== NEWSFILE MODULE V1.0 ============= 10/20/90 =
30005 IFO$(10)="REP"THENF$="sys.news":U=D(1,0):D=D(1,1):GOSUB35060:GOTO2160
30010 ON(W1-500)GOTO31000,32000,33000,34000,35000:GOTO920
30020 OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,r":RETURN
30100 GOSUB4:IFW6$<>""THENC$=CHR$(20)+R$:GOSUB28:IFI=2THENO$=A$:GOSUB9:RETURN:ELSEIFW6$<>""THENFORX=1TOLEN(W6$):O$=CHR$(20):GOSUB9:NEXTX
30200 X=A:GOSUB5:IFI$=""THENRETURN:ELSEW6$=I$:RETURN
30300 O$=T$(105):GOSUB4:X=1:GOSUB5:M3$=I$:RETURN
31000 GOSUB8030:IFETHEN920:ELSEGOSUB990:IFM3$="*"THENGOSUB30300
31010 W2=ASC(M3$)-193:IFW2<0ORW2>25THEN920
31020 O(12)=2:O(10)=W2:OPEN1,U,15:GOSUB30020:INPUT#1,I:IFITHEN31030:ELSEIFW2>0THENFORI=1TOW2:SYS8213:NEXTI:IFPEEK(253)=0THEN31040
31025 IFW2=0THEN31040
31030 O$=T$(106):GOSUB4:O(12)=0:GOSUB400:W1$=O$(2):W2$="9912312359":W3$="SUBJECT":W5$="11111111111111111111111111":O(9)=0:GOTO31050
31040 O(9)=1:SYS8222:W1$=I$:SYS8222:W2$=I$:SYS8222:W3$=I$:SYS8222:W5$=I$:SYS8222:L=0:O$(5)="":GOSUB8350
31050 CLOSE2:CLOSE1:O$="{black}{ct k}New until date YYMMDDHHMM{ct k}             : {white}"+W1$+"{ct c}":W6$=W1$:A=10:GOSUB30100:W1$=W6$:IFLEN(W1$)<>10THEN31050
31060 O$="{black}{ct k}Deletion date  YYMMDDHHMM{ct k}             : {white}"+W2$+"{ct c}":W6$=W2$:A=10:GOSUB30100:W2$=W6$:IFLEN(W2$)<>10THEN31060
31070 O$="{black}{ct k}Subject      : {white}"+W3$+"{ct c}":W6$=W3$:A=20:GOSUB30100:W3$=W6$
31080 GOSUB41700:O(11)=0:O$(5)=W1$+R$+W2$+R$+W3$+R$+W5$:GOSUB1000:GOTO940
32000 GOSUB8030:IFETHEN920:ELSEGOSUB990:IFM3$="*"THENGOSUB30300
32010 I=ASC(M3$)-193:IFI<0ORI>25THEN920:ELSEO$="{ct k}{black}Deleting...":GOSUB4:GOSUB40000:GOTO940
33000 GOSUB8030:IFETHEN920
33010 O$=R$:GOSUB9:GOSUB30020:X=0
33020 X=X+1:SYS8222:W1$=I$:SYS8222:SYS8222:W2$=I$:SYS8222:IFPEEK(253)THEN33060:ELSEIFMID$(I$,ASC(U$(5))-192,1)<>"1"THEN33050
33030 O$="{black}"+CHR$(X+192)+")"+LEFT$(W2$+SP$,20)+"{f7}   New Until: ":W3$=U$(6):U$(6)=W1$:GOSUB400:U$(6)=W3$:O$=O$+O$(4):GOSUB4
33050 SYS8213:GOSUB8:IFA$<>" "THEN33020
33060 CLOSE2:CLOSE1:GOTO940
34000 GOSUB8030:IFETHEN920:ELSEGOSUB990:IFM3$="*"THENGOSUB30300
34010 W1=ASC(M3$)-193:IFW1<0ORW1>25THEN920
34020 GOSUB30020:IFW1>0THENFORI=1TOW1:SYS8213:NEXTI
34030 FORI=1TO5:SYS8222:NEXTI:SYS8210:CLOSE2:GOSUB27:GOTO940
35000 GOSUB8030:IFETHEN920
35010 GOSUB35060:GOTO940
35060 X=0:OPEN1,U,15:GOSUB30020:INPUT#1,I:IFI>20THENCLOSE1:CLOSE2:O$=T$(107):GOSUB4:RETURN
35080 SYS8222:IFU$(6)>I$THEN35120:ELSEA$=I$:SYS8222:SYS8222:SYS8222:IFMID$(I$,ASC(U$(5))-192,1)<>"1"THEN35120
35100 SYS8210:X=X+1:O$="RETURN>{ct c}":GOSUB4:C$=R$:GOSUB28:O$=R$:GOSUB4:IFPEEK(255)THEN35080:ELSE35140
35120 SYS8213:IFPEEK(253)THEN35140:ELSE35080
35140 CLOSE1:CLOSE2:IFX=0THENO$=T$(108):GOSUB4
35150 RETURN
40000 IFF$=""THENRETURN:ELSEX=0:OPEN1,U,15,"s"+MID$(STR$(D),2)+":sys.work":GOSUB30020:INPUT#1,E:IFETHENCLOSE1:CLOSE2:RETURN
40100 OPEN3,U,3,MID$(STR$(D),2)+":sys.work,s,w":INPUT#1,E:IFETHEN40700
40200 IFX=ITHENSYS8213:IFPEEK(253)THEN40500
40300 IFX>0THENPRINT#3,CHR$(1)
40400 GOSUB31:X=X+1:IFPEEK(253)THEN40500:ELSE40200
40500 INPUT#1,E:CLOSE3:CLOSE2:IFE>0THEN40700:ELSEPRINT#1,"s"+MID$(STR$(D),2)+":"+F$:PRINT#1,"r"+MID$(STR$(D),2)+":"+F$+"=sys.work"
40600 GOSUB30020:GET#2,A$:E=ST:CLOSE2:IFE>0THENPRINT#1,"s"+MID$(STR$(D),2)+":"+F$:CLOSE1:RETURN:ELSECLOSE1:RETURN
40700 O$="Disk error, clearing...":GOSUB4:PRINT#1,"s"+MID$(STR$(D),2)+":sys.work":PRINT#1,"v"+MID$(STR$(D),2):CLOSE1:RETURN
41700 IFLEN(W5$)<26THENW5$="00000000000000000000000000"
41705 O$="":FORX=1TO26:IFMID$(W5$,X,1)="1"THENA$=CHR$(X+192):ELSEA$=" "
41710 O$=O$+A$:NEXTX:O$="{ct k}{black}Access: {white}"+O$+"{ct c}":GOSUB4
41715 C$=CHR$(20)+R$:GOSUB28:IFI=2THENO$=A$:GOSUB9:RETURN
41720 FORX=1TO28:O$=CHR$(20):GOSUB9:NEXTX:O$=" Toggle: {ct c}":GOSUB4:X=26:GOSUB5:IFI$=""THENRETURN
41730 FORX=1TOLEN(I$):A=ASC(MID$(I$,X,1))-192:IFA<1ORA>26THEN41750
41740 MID$(W5$,A,1)=MID$(STR$(ABS(VAL(MID$(W5$,A,1))-1)),2)
41750 NEXTX:GOTO41705
42010 I$=MID$(STR$(VAL(I$)),2):RETURN
55555 A=PEEK(186):OPEN1,A,15,"s0:prg.news":CLOSE1:DSAVE"prg.news",U(A):STOP
