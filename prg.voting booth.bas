!--------------------------------------------------
!- Monday, May 15, 2017 3:03:57 AM
!- Import of : 
!- c:\src\zelch128\prg.voting booth.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM ============ VOTING BOOTH MODULE V1.0 =========== 10/20/90 =
30010 ON(W1-300)GOTO30400,32500,32900,33500,35000,35400:GOTO940
30050 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.voting booth":RETURN
30060 OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,r":RETURN
30100 O$=T$(79):GOSUB4:DO:POKE2831,1:GOSUB8:I=ASC(A$):LOOPUNTIL(I=13)OR(I>192ANDI<219):O$=A$:GOSUB4:IFI=13THENI=0:RETURN:ELSEIFW1=301THENI=I-192:RETURN
30200 GOSUB30050:RECORD#2,I-192:SYS8222:SYS8222:CLOSE2:IFMID$(I$,ASC(U$(5))-192,1)<>"1"THENI=0:RETURN:ELSEI=I-192:RETURN
30400 GOSUB990:IFM3$="*"THENGOSUB30100:IFI=0THEN920
30500 IFM3$="*"THENW5=I:GOTO30900:ELSEIFM3$<>"#"THENW5=ASC(M3$)-192:GOTO30900
30600 O$=T$(80):GOSUB4:W5=1:GOSUB30050
30700 RECORD#2,W5:O$=".":GOSUB9:SYS8222:IFI$="{pound}"THENO$=R$:GOSUB9:CLOSE2:GOTO30900:ELSEW5=W5+1:IFW5<27THEN30700
30800 CLOSE2:O$=T$(81):GOSUB4:GOTO920
30900 GOSUB30050:RECORD#2,W5:U=D(2,0):D=D(2,1):SYS8222:W5$=I$:SYS8222:W6$=I$:SYS8222:SYS8222:SYS8222:W9$=I$:CLOSE2:IFW5$="{pound}"THENW5$="VOTE TOPIC":W9$=""
31100 IFM3$="#"THEN31400:ELSEGOSUB36000
31400 FORI=1TO100:TT$(I)="":NEXT:I=FRE(1):O$="{ct k}{black}Subject of voting topic{ct k}: "+W5$+"{ct c}":W7$=W5$:A=20:GOSUB35900:W5$=W7$
31450 GOSUB400:W8$=W5$+R$+W6$+R$+STR$(ID)+R$+O$(3)+R$:O$=T$(83):GOSUB4:F$="vote.text "+CHR$(W5+64):O(12)=0:GOSUB8330:O(8)=23:O(12)=1:GOSUB1010:IFO(11)THEN920
31470 GOSUB990:IFW9$<>""THENI=VAL(W9$):ELSEI=VAL(M3$):IFM3$="*"THENO$="{ct k}{black}N)ormal topic or Q)uestionaire: {ct c}":GOSUB4:C$="NQ"+R$:GOSUB28:O$=A$:GOSUB4:IFI=3THEN920
31500 GOSUB400:GOSUB30050:RECORD#2,W5:PRINT#2,W8$+STR$(I):CLOSE2:IFI=2THEN37000
31600 OPEN1,U,15:GOSUB30060:INPUT#1,I:IFI>20THENCLOSE2:CLOSE1:W1=0:GOTO32000
31700 INPUT#2,W1:FORI=1TOW1:INPUT#2,TT$(I),TT$(I+50):NEXTI:CLOSE2:CLOSE1:W1=0
32000 W7$=TT$(W1+1):O$="{ct k}{black}Key to choose option #"+STR$(W1+1)+": "+W7$+"{ct c}":GOSUB4:IFW7$=""THEN32003
32001 C$=R$+CHR$(20):GOSUB28:IFW7$=""ANDI=1THEN32005:ELSEIFW7$=""ANDI=2THEN32003
32002 O$=A$:GOSUB9:I$=W7$:IFI=1THEN32010
32003 X=1:GOSUB5:W7$=I$:IFW7$<>""THEN32010
32005 O$="{ct k}{black}Was that your last choice (y/n)? {ct c}":GOSUB4:C$="NY":GOSUB28:O$=A$:GOSUB4:IFI=1THEN32000:ELSE32200
32010 W1=W1+1:TT$(W1)=I$:IFW1>49THEN32200
32100 W7$=TT$(W1+50):IFW7$=""THENW7$="DESCRIPTION"
32105 O$="{black}Description for #"+STR$(W1)+"{ct k}: "+W7$+"{ct c}":A=60:GOSUB35900:I$=W7$
32110 IFI$=""ANDTT$(W1+50)=""THEN32100:ELSEIFI$<>""THENTT$(W1+50)=I$:GOTO32000:ELSE32000
32200 O$=T$(82):GOSUB4:OPEN1,U,15,"s"+MID$(STR$(D),2)+":vote.topic "+CHR$(W5+64):CLOSE1:OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(W5+64)+",s,w"
32300 PRINT#2,W1:FORA=1TOW1:PRINT#2,TT$(A):PRINT#2,TT$(A+50):NEXTA:CLOSE2:GOTO940
32500 GOSUB990:IFM3$<>"*"THENW5=ASC(M3$)-192:GOTO32600:ELSEW1=301:GOSUB30100:W5=I:IFI=0THEN920
32600 O$="{ct k}{black}Delete vote topic "+CHR$(W5+192)+" (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:O$=A$:GOSUB4:IFI=2THEN920:ELSEGOSUB30050
32700 RECORD#2,W5:PRINT#2,"{pound}"+R$+"00000000000000000000000000"+R$+"0"+R$+"0":CLOSE2
32800 OPEN1,D(2,0),15,"s"+MID$(STR$(D(2,1)),2)+":vote.topic "+CHR$(W5+64):PRINT#1,"s"+MID$(STR$(D(2,1)),2)+":vote.text "+CHR$(W5+64):CLOSE1:GOTO940
32900 GOSUB990:IFM3$<>"*"THENW5=ASC(M3$)-192:GOTO33000:ELSEGOSUB30100:W5=I:IFI=0THEN920
33000 O$="{ct k}{black}Reset vote results "+CHR$(W5+192)+" (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:O$=A$:GOSUB4:IFI=2THEN920
33100 GOSUB30050:RECORD#2,W5:SYS8222:CLOSE2:U=D(2,0):D=D(2,1):IFI$="{pound}"THEN33400
33200 OPEN1,U,15,"s"+MID$(STR$(D),2)+":sys.work":PRINT#1,"r"+MID$(STR$(D),2)+":sys.work=vote.topic "+CHR$(64+W5):INPUT#1,I:IFI>20THENCLOSE1:GOTO33400
33300 OPEN2,U,2,MID$(STR$(D),2)+":sys.work,s,r":OPEN3,U,3,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,w"
33310 GOSUB31:CLOSE3:CLOSE2:PRINT#1,"s"+MID$(STR$(D),2)+":sys.work":CLOSE1
33400 O$="{ct k}{black}Done.":GOSUB4:GOTO940
33500 GOSUB990:IFINSTR("*+-",M3$)=0THENW5=ASC(M3$)-192:GOTO33600:ELSEIFM3$="*"THENGOSUB30100:W5=I:IFI=0THEN920:ELSEIFM3$="*"THEN33600
33510 IFM3$="+"ANDW5>0ANDW5<26THENW5=W5+1:GOTO33600:ELSEIFM3$="-"ANDW5>0ANDW5<27THENW5=W5-1:GOTO33600:ELSEW5=1:GOTO920
33600 W1=0:W2=0:FORA=0TO50:TT$(A)="":TT$(A+50)="":VT(A)=0:NEXTA:A=FRE(1)
33700 GOSUB30050:RECORD#2,W5:SYS8222:W5$=I$:SYS8222:W6$=I$:SYS8222:SYS8222:SYS8222:W9$=I$:U=D(2,0):D=D(2,1):CLOSE2
33800 IFW5$="{pound}"ORMID$(W6$,ASC(U$(5))-192,1)="0"THEN920:ELSEO$="{clear}{ct k}{black}"+W5$+"{ct k}":GOSUB4:F$="vote.text "+CHR$(64+W5):GOSUB26
33900 O$=T$(84):GOSUB4:OPEN1,U,15:GOSUB30060:INPUT#1,I:IFI>20THENCLOSE2:CLOSE1:GOTO920:ELSEIFVAL(W9$)=2THENO$="{ct k*2}":GOSUB4:GOTO38000
34000 INPUT#2,W3:FORI=1TOW3:SYS8222:TT$(I)=I$:SYS8222:TT$(I+50)=I$:NEXTI:CLOSE2:CLOSE1
34100 E=0:GOSUB30060:SYS8213:IFPEEK(253)THENE=1:GOTO34400
34200 DO:SYS8222:IFI$=""THENEXIT:ELSEW1=W1+1:VT(VAL(I$))=VT(VAL(I$))+1:SYS8222:IFSTR$(ID)=I$ORSTR$(ID)+" "=I$THENW2=1
34300 LOOPUNTILPEEK(253)
34400 CLOSE2:IFW2=1THEN34800:ELSEO$="{ct k}":GOSUB4:C$="":FORI=1TOW3:O$="{black}"+TT$(I)+") "+TT$(I+50):C$=C$+TT$(I):GOSUB4:NEXTI:C$=R$+C$
34500 O$=T$(85):GOSUB4:GOSUB28:O$=A$:GOSUB4:IFI=1THEN920:ELSEO$=T$(86):GOSUB4:W1=W1+1:VT(I-1)=VT(I-1)+1
34600 OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(W5+64)+",s,a":IFE=1THENPRINT#2,CHR$(1)
34700 PRINT#2,STR$(I-1):PRINT#2,STR$(ID):CLOSE2
34800 O$="{ct k}{black}{ct k}Results out of"+STR$(W1)+" vote(s).{ct k}":GOSUB4:FORI=1TOW3:O$="{black}"+RIGHT$(" "+STR$(VT(I)),3)+" ("+RIGHT$(" "+STR$(INT(VT(I)/W1*100)),3)
34900 O$=O$+"%): "+TT$(I+50):GOSUB4:NEXTI:O$="{ct k}{black}RETURN>{ct c}":GOSUB4:C$=R$:GOSUB28:O$=A$:GOSUB4:IFW2<>1THEN940:ELSE920
35000 GOSUB990:W1=VAL(M3$):GOSUB30050:O$=R$:GOSUB9:X=0
35100 X=X+1:RECORD#2,X:SYS8222:W1$=I$:SYS8222:W2$=I$:SYS8222:W3$=I$:SYS8222:W4$=I$
35200 IF(MID$(W2$,ASC(U$(5))-192,1)="0"ANDW1=0)ORW1$="{pound}"THEN35300
35210 O$="{black}"+CHR$(192+X)+") "+LEFT$(W1$+"               ",20)+"{f7}   "+W4$
35250 IFW1THENO$=O$+"{ct k}   By: "+UI$(VAL(W3$))+" (ID#"+W3$+") ":IFVAL(W2$)=0THENO$=O$+"*UNVALIDATED*":GOSUB4:ELSEGOSUB4
35300 GOSUB8:IFX<26ANDA$<>" "THEN35100:ELSECLOSE2:GOTO940
35400 GOSUB990:IFM3$<>"*"THENI=ASC(M3$)-192:ELSEW1=301:GOSUB30100:IFI=0THEN920
35500 W5=I:GOSUB990:IFM3$<>"*"THENW6$=M3$:GOTO35700
35600 O$="{black}Access : {white}ABCDEFGHIJKLMNOPQRSTUVWXYZ{ct k}   New : {ct c}":GOSUB4:X=26:GOSUB5:IFLEN(I$)=26THENW6$=I$:ELSE35600
35700 GOSUB30050:RECORD#2,W5:SYS8222:W1$=I$:SYS8222:SYS8222:W2$=I$:SYS8222:W3$=I$
35800 RECORD#2,W5:PRINT#2,W1$+R$+W6$+R$+W2$+R$+W3$+R$:CLOSE2:GOTO940
35900 GOSUB4:IFW7$<>""THENC$=CHR$(20)+R$:GOSUB28:IFI=2THENO$=A$:GOSUB9:RETURN:ELSEIFW7$<>""THENFORX=1TOLEN(W7$):O$=CHR$(20):GOSUB9:NEXTX
35910 IFA=60THEN35920:ELSEX=A:GOSUB5:IFI$=""THENRETURN:ELSEW7$=I$:RETURN
35920 POKE2847,A:POKE2895,1:GOSUB6:IFI$=""THENRETURN:ELSEW7$=I$:RETURN
36000 IFLEN(W6$)<26THENW6$="00000000000000000000000000"
36005 O$="":FORX=1TO26:IFMID$(W6$,X,1)="1"THENA$=CHR$(X+192):ELSEA$=" "
36010 O$=O$+A$:NEXTX:O$="{ct k}{black}Access: {white}"+O$+"{ct c}":GOSUB4
36015 C$=CHR$(20)+R$:GOSUB28:IFI=2THENO$=A$:GOSUB9:RETURN
36020 FORX=1TO28:O$=CHR$(20):GOSUB9:NEXTX:O$=" Toggle: {ct c}":GOSUB4:X=26:GOSUB5:IFI$=""THENRETURN
36030 FORX=1TOLEN(I$):A=ASC(MID$(I$,X,1))-192:IFA<1ORA>26THEN36050
36040 MID$(W6$,A,1)=MID$(STR$(ABS(VAL(MID$(W6$,A,1))-1)),2)
36050 NEXTX:GOTO36005
37000 OPEN1,U,15:GOSUB30060:INPUT#1,E:W1=1:IFETHEN37010:ELSEINPUT#2,W1:FORI=1TOW1:SYS8222:TT$(I)=I$:NEXTI
37010 CLOSE2:CLOSE1:O$="{black}Enter questions,{f7}press return when done.":GOSUB4:W9=1
37020 W7$=TT$(W9):O$="{black}Question #"+STR$(W9)+"{ct k}: "+W7$+"{ct c}":A=60:GOSUB35900:TT$(W9)=W7$
37030 IFTT$(W9)<>""THEN37040:ELSEO$="{ct k}{black}Was that your last choice (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:O$=A$:GOSUB4:IFI=2THEN37020:ELSE37050
37040 W9=W9+1:IFW9<51THEN37020
37050 OPEN1,U,15,"s"+MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5):CLOSE1:OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,w"
37060 PRINT#2,W9-1:FORW1=1TOW9-1:PRINT#2,TT$(W1):NEXTW1:CLOSE2:GOTO940
38000 Y=0:INPUT#2,W1:FORX=1TOW1:SYS8222:TT$(X)=I$:NEXTX
38010 SYS8222:IFPEEK(253)THEN38100:ELSEIFID=VAL(I$)THENY=1
38020 FORX=1TOW1:SYS8222:NEXTX:GOTO38010
38100 CLOSE1:CLOSE2:IFYTHEN38200:ELSEO$=T$(104):GOSUB4:C$="YN"+R$:GOSUB28:O$=A$:GOSUB4:IFI>1THEN920
38110 O$="":GOSUB4:FORW2=1TOW1:O$="{ct k}{black}"+TT$(W2)+"{ct k}:{white}{ct c}":GOSUB4:X=80-LEN(O$):GOSUB5:TT$(W2+50)=I$:NEXTW2:O$="{ct k}{black}Save your responses (y/n/a)? {ct c}":GOSUB4
38120 C$="YNA":GOSUB28:O$=A$:GOSUB4:ONIGOTO38130,38110,920
38130 OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,a":PRINT#2,STR$(ID):FORX=1TOW1:PRINT#2,TT$(X+50):NEXTX:CLOSE2
38200 O$="{ct k}Responses on file:":GOSUB4
38210 OPEN1,U,15:GOSUB30060:SYS8222:W1=VAL(I$):FORX=1TOW1:SYS8222:NEXTX
38220 O$="":SYS8222:IFPEEK(253)THEN38240:ELSEIFMID$(U$(8),4,1)="1"THENO$="{yellow}{ct k}By: {white}"+UI$(VAL(I$))+"{yellow} (ID#{white}"+I$+"{yellow}){ct k}"
38230 GOSUB4:FORX=1TOW1:SYS8222:O$="{black}"+TT$(X)+"{ct k}{white}:"+I$:GOSUB4:NEXTX:GOTO38220
38240 CLOSE2:CLOSE1:IFYTHEN920:ELSE940
55555 A=PEEK(186):OPEN1,A,15,"s0:prg.voting booth":CLOSE1:DSAVE"prg.voting booth",U(A):STOP
