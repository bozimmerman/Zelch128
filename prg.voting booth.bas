!--------------------------------------------------
!- Wednesday, May 17, 2017 12:22:15 AM
!- Import of : 
!- c:\src\zelch128next\prg.voting booth.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM ============ VOTING BOOTH MODULE V1.7 =========== 02/10/92 =
30010 ON(W1-300)GOTO30400,32500,32900,33500,35000,35400:GOTO940
30050 OPEN2,D(1,0),2,MID$(STR$(D(1,1)),2)+":sys.voting booth":RETURN
30060 OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,r":RETURN
30100 O$=T$(79):GOSUB770:IFW1=301ORI=0THENRETURN:ELSEI=I+192
30200 GOSUB30050:RECORD#2,I-192:SYS8222:SYS8222:CLOSE2:IFMID$(I$,ASC(U$(5))-192,1)<>"1"THENI=0:RETURN:ELSEI=I-192:RETURN
30399 REM ----------- CREATE/EDIT TOPIC
30400 GOSUB760:IFSY$="+"THEN30600:ELSEIFI>0ANDI<26THENW5=I:GOTO30900:ELSEIFSY$<>"*"THEN920:ELSEGOSUB30100:IFI=0THEN920:ELSEW5=I:GOTO30900
30600 O$=T$(80):GOSUB4:W5=1:GOSUB30050
30700 RECORD#2,W5:O$=".":GOSUB9:SYS8222:IFI$="{pound}"THENO$=R$:GOSUB9:CLOSE2:GOTO30900:ELSEW5=W5+1:IFW5<27THEN30700
30800 CLOSE2:O$=T$(81):GOSUB4:GOTO920
30900 GOSUB30050:RECORD#2,W5:U=D(2,0):D=D(2,1):SYS8222:W5$=I$:SYS8222:W6$=I$:SYS8222:SYS8222:SYS8222:W9$=I$:CLOSE2:IFW5$="{pound}"THENW5$="":W9$=""
31100 IFSY$<>"+"ORMID$(U$(8),4,1)="1"THENE=0:SY$=W6$:W2$="{ct k}{black}Access: ":GOSUB610:W6$=SY$
31400 FORI=1TO100:TT$(I)="":NEXT:I=FRE(1):O$="{ct k}{black}Subject of voting{f7}topic: "+W5$+"{ct c}":W7$=W5$:A=20:IFW5$THENGOSUB35900:W5$=W7$:ELSEGOSUB4:GOSUB35910:W5$=W7$
31450 GOSUB400:W8$=W5$+R$+W6$+R$+STR$(ID)+R$+O$(3)+R$:O$=T$(83):GOSUB4:F$="vote.text "+CHR$(W5+64):O(12)=0:GOSUB8330:O(8)=23:O(12)=1:GOSUB1010:IFO(11)THEN920
31470 GOSUB990:IFW9$<>""THENI=VAL(W9$):ELSEI=VAL(SY$):IFSY$="*"THENO$="{ct k}{black}N)ormal topic or Q)uestionaire: {ct c}":GOSUB4:C$="NQ"+R$:GOSUB28:IFI=3THEN920
31500 GOSUB400:GOSUB30050:RECORD#2,W5:PRINT#2,W8$+STR$(I):CLOSE2:IFI=2THEN37000
31600 OPEN1,U,15:GOSUB30060:INPUT#1,I:IFI>20THENCLOSE2:CLOSE1:W1=0:GOTO32000
31700 INPUT#2,W1:FORI=1TOW1:INPUT#2,TT$(I):NEXTI:CLOSE2:CLOSE1:W1=0
32000 W7$=TT$(W1+1):O$="{ct k}{black}Description for choice{f7}"+CHR$(W1+193)+": "+W7$+"{ct c}":A=60:IFW7$THENGOSUB35900:ELSEGOSUB4:GOSUB35910
32010 IFW7$=""THEN32050:ELSETT$(W1+1)=W7$:W1=W1+1:IFW1<26THEN32000:ELSE32200
32050 O$="{ct k}{black}Was that your last choice (y/n)? {ct c}":GOSUB4:C$="NY":GOSUB28:IFI=1THEN32000
32200 O$=T$(82):GOSUB4:OPEN1,U,15,"s"+MID$(STR$(D),2)+":vote.topic "+CHR$(W5+64):CLOSE1:OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(W5+64)+",s,w"
32300 PRINT#2,W1:FORA=1TOW1:PRINT#2,TT$(A):NEXTA:CLOSE2:GOTO940
32499 REM ----------- DELETE TOPIC
32500 GOSUB760:IFI<1ORI>26THEN32550:ELSEI=I+192:GOSUB30200:IFI=0THEN920:ELSEW5=I:GOTO32600
32550 GOSUB30100:W5=I:IFI=0THEN920
32600 O$="{ct k}{black}Are you sure (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:IFI=2THEN920:ELSEGOSUB30050
32700 RECORD#2,W5:PRINT#2,"{pound}"+R$+"00000000000000000000000000"+R$+"0"+R$+"0":CLOSE2
32800 OPEN1,D(2,0),15,"s"+MID$(STR$(D(2,1)),2)+":vote.topic "+CHR$(W5+64):PRINT#1,"s"+MID$(STR$(D(2,1)),2)+":vote.text "+CHR$(W5+64):CLOSE1:GOTO940
32899 REM ----------- RESET TOPIC RESULTS
32900 GOSUB760:IFI<1ORI>26THEN32950:ELSEI=I+192:GOSUB30200:IFI=0THEN920:ELSEW5=I:GOTO33000
32950 GOSUB30100:W5=I:IFI=0THEN920
33000 O$="{ct k}{black}Reset vote results (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:IFI=2THEN920
33100 GOSUB30050:RECORD#2,W5:SYS8222:CLOSE2:U=D(2,0):D=D(2,1):IFI$="{pound}"THEN33400
33200 OPEN1,U,15,"s"+MID$(STR$(D),2)+":sys.work":PRINT#1,"r"+MID$(STR$(D),2)+":sys.work=vote.topic "+CHR$(64+W5):INPUT#1,I:IFI>20THENCLOSE1:GOTO33400
33300 OPEN2,U,2,MID$(STR$(D),2)+":sys.work,s,r":OPEN3,U,3,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,w"
33310 GOSUB31:CLOSE3:CLOSE2:PRINT#1,"s"+MID$(STR$(D),2)+":sys.work":CLOSE1
33400 O$="{ct k}{black}Done.":GOSUB4:GOTO940
33499 REM ----------- VOTE ON TOPIC
33500 GOSUB760:IFI>0ANDI<27THENI=I+192:GOSUB30200:W5=I:ON(SGN(I)+1)GOTO920,33600
33510 IFSY$="*"THENGOSUB30100:W5=I:ON(SGN(I)+1)GOTO920,33600
33550 IFSY$="+"ANDW5>0ANDW5<26THENW5=W5+1:GOTO33600:ELSEIFSY$="-"ANDW5>0ANDW5<27THENW5=W5-1:GOTO33600:ELSEW5=1:GOTO920
33600 W1=0:W2=0:FORA=0TO26:TT$(A)="":VT(A)=0:NEXTA:A=FRE(1)
33700 GOSUB30050:RECORD#2,W5:SYS8222:W5$=I$:SYS8222:W6$=I$:SYS8222:SYS8222:SYS8222:W9$=I$:U=D(2,0):D=D(2,1):CLOSE2
33800 IFW5$="{pound}"ORMID$(W6$,ASC(U$(5))-192,1)="0"THEN920:ELSEO$="{clear}{ct k}{black}"+W5$+"{ct k}":GOSUB4:F$="vote.text "+CHR$(64+W5):GOSUB26
33900 O$=T$(84):GOSUB4:OPEN1,U,15:GOSUB30060:INPUT#1,I:IFI>20THENCLOSE2:CLOSE1:GOTO920:ELSEIFVAL(W9$)=2THENO$="{ct k*2}":GOSUB4:GOTO38000
34000 INPUT#2,W3:FORI=1TOW3:SYS8222:TT$(I)=I$:NEXTI:CLOSE2:CLOSE1
34100 E=0:GOSUB30060:SYS8213:IFPEEK(253)THENE=1:GOTO34400
34200 DO:SYS8222:IFI$=""THENEXIT:ELSEW1=W1+1:VT(VAL(I$))=VT(VAL(I$))+1:SYS8222:IFSTR$(ID)=I$ORSTR$(ID)+" "=I$THENW2=1
34300 LOOPUNTILPEEK(253)
34400 CLOSE2:IFW2=1THEN34800:ELSEO$="{ct k}":GOSUB4:C$="":FORI=1TOW3:O$="{black}"+CHR$(I+192)+") "+TT$(I):C$=C$+CHR$(I+192):GOSUB4:NEXTI:C$=R$+C$
34500 O$=T$(85):GOSUB4:GOSUB28:IFI=1THEN920:ELSEO$=T$(86):GOSUB4:W1=W1+1:VT(I-1)=VT(I-1)+1
34600 OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(W5+64)+",s,a":IFE=1THENPRINT#2,CHR$(1)
34700 PRINT#2,STR$(I-1):PRINT#2,STR$(ID):CLOSE2
34800 O$="{ct k}{black}{ct k}Results out of"+STR$(W1)+" vote(s).{ct k}":GOSUB4:FORI=1TOW3:O$="{black}"+RIGHT$(" "+STR$(VT(I)),3)+" ("+RIGHT$(" "+STR$(INT(VT(I)/W1*100)),3)
34900 O$=O$+"%): "+TT$(I):GOSUB4:NEXTI:O$="{ct k}{black}RETURN>{ct c}":GOSUB4:C$=R$:GOSUB28:IFW2<>1THEN940:ELSE920
34999 REM ----------- LIST TOPICS
35000 GOSUB990:W0$="":W1=VAL(SY$):IFW1>1THENW0$="#"
35010 GOSUB760:IFI>0ANDI<27THENX=I-1:ELSEX=0
35020 GOSUB760:IFI>0ANDI<27THENY=I:ELSEY=26
35050 GOSUB30050:O$=R$:GOSUB9
35100 X=X+1:RECORD#2,X:SYS8222:W1$=I$:SYS8222:W2$=I$:SYS8222:W3$=I$:SYS8222:W4$=I$
35200 IF(MID$(W2$,ASC(U$(5))-192,1)="0"ANDW1=0)ORW1$="{pound}"THEN35300
35210 A$=CHR$(192+X):IFW0$="#"THENA$=RIGHT$(STR$(X),2)
35230 O$="{black}"+A$+") "+LEFT$(W1$+"               ",20)+"{f7}   "+W4$
35250 IFW1THENO$=O$+"{ct k}   By: "+UI$(VAL(W3$))+" (ID#"+W3$+") ":IFVAL(W2$)=0THENO$=O$+"*UNVALIDATED*":GOSUB4:ELSEGOSUB4
35300 GOSUB8:IFX<YANDA$<>" "THEN35100:ELSECLOSE2:GOTO940
35399 REM ----------- VALIDATE TOPIC
35400 GOSUB760:IFI>0ANDI<27THEN35500
35450 W1=301:GOSUB30100:IFI=0THEN920
35500 W5=I:GOSUB990:IFSY$<>"*"THENW6$=SY$:GOTO35700
35600 E=0:W2$="{ct k}{black}Access: ":GOSUB610:W6$=SY$
35700 GOSUB30050:RECORD#2,W5:SYS8222:W1$=I$:SYS8222:SYS8222:W2$=I$:SYS8222:W3$=I$
35800 RECORD#2,W5:PRINT#2,W1$+R$+W6$+R$+W2$+R$+W3$+R$:CLOSE2:GOTO940
35900 GOSUB4:IFW7$<>""THENC$=CHR$(20)+R$:GOSUB32:IFI=2THENO$=A$:GOSUB9:RETURN:ELSEIFW7$<>""THENFORX=1TOLEN(W7$):O$=CHR$(20):GOSUB9:NEXTX
35910 IFA=60THEN35920:ELSEX=A:GOSUB5:IFI$=""THENRETURN:ELSEW7$=I$:RETURN
35920 POKE2847,A:POKE2895,1:GOSUB6:IFI$=""THENRETURN:ELSEW7$=I$:RETURN
37000 OPEN1,U,15:GOSUB30060:INPUT#1,E:W1=1:IFETHEN37010:ELSEINPUT#2,W1:FORI=1TOW1:SYS8222:TT$(I)=I$:NEXTI
37010 CLOSE2:CLOSE1:O$="{black}Enter questions,{f7}press return when done.":GOSUB4:W9=1
37020 W7$=TT$(W9):O$="{black}Question #"+STR$(W9)+"{ct k}: "+W7$+"{ct c}":A=60:GOSUB35900:TT$(W9)=W7$
37030 IFTT$(W9)<>""THEN37040:ELSEO$="{ct k}{black}Was that your last choice (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:IFI=2THEN37020:ELSE37050
37040 W9=W9+1:IFW9<51THEN37020
37050 OPEN1,U,15,"s"+MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5):CLOSE1:OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,w"
37060 PRINT#2,W9-1:FORW1=1TOW9-1:PRINT#2,TT$(W1):NEXTW1:CLOSE2:GOTO940
38000 Y=0:INPUT#2,W1:FORX=1TOW1:SYS8222:TT$(X)=I$:NEXTX
38010 SYS8222:IFPEEK(253)THEN38100:ELSEIFID=VAL(I$)THENY=1
38020 FORX=1TOW1:SYS8222:NEXTX:GOTO38010
38100 CLOSE1:CLOSE2:IFYTHEN38200:ELSEO$=T$(104):GOSUB4:C$="YN"+R$:GOSUB28:IFI>1THEN920
38110 O$="":GOSUB4:FORW2=1TOW1:O$="{ct k}{black}"+TT$(W2)+"{ct k}:{white}{ct c}":GOSUB4:X=80-LEN(O$):GOSUB5:TT$(W2+50)=I$:NEXTW2:O$="{ct k}{black}Save your responses (y/n/a)? {ct c}":GOSUB4
38120 C$="YNA":GOSUB28:ONIGOTO38130,38110,920
38130 OPEN2,U,2,MID$(STR$(D),2)+":vote.topic "+CHR$(64+W5)+",s,a":PRINT#2,STR$(ID):FORX=1TOW1:PRINT#2,TT$(X+50):NEXTX:CLOSE2
38200 O$="{ct k}Responses on file:":GOSUB4
38210 OPEN1,U,15:GOSUB30060:SYS8222:W1=VAL(I$):FORX=1TOW1:SYS8222:NEXTX
38220 O$="":SYS8222:IFPEEK(253)THEN38240:ELSEIFMID$(U$(8),4,1)="1"THENO$="{yellow}{ct k}By: {white}"+UI$(VAL(I$))+"{yellow} (ID#{white}"+I$+"{yellow}){ct k}"
38230 GOSUB4:FORX=1TOW1:SYS8222:O$="{black}"+TT$(X)+"{ct k}{white}:"+I$:GOSUB4:NEXTX:GOTO38220
38240 CLOSE2:CLOSE1:IFYTHEN920:ELSE940
55555 A=PEEK(186):OPEN1,A,15,"s0:prg.voting booth":CLOSE1:DSAVE"prg.voting booth",U(A):STOP
