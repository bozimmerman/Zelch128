!--------------------------------------------------
!- Monday, May 15, 2017 12:17:52 AM
!- Import of : 
!- c:\src\zelch128\prg.voting booth.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM ============ VOTING BOOTH MODULE V1.0 =========== 10/20/90 =
30010 ON(W1-300)GOTO30400,32500,32900,33500,35000:GOTO940
30100 O$=T$(79):GOSUB4:DO:POKE2831,1:GOSUB8:LOOPUNTIL(A$=R$)OR(ASC(A$)>192ANDASC(A$)<213):O$=A$:GOSUB4:IFA$=R$THENI=0:RETURN
30200 OPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth":RECORD#2,ASC(A$)-192:FORI=1TO4:SYS8222:NEXTI:CLOSE2
30300 IFMID$(I$,ASC(U$(5))-192,1)<>"1"THENI=0:RETURN:ELSEI=ASC(A$)-192:RETURN
30400 GOSUB990:I=0:IFM3$="*"THENGOSUB30100:IFA$=R$THEN920:ELSEIFM3$="*"THENW5=ASC(A$)-192:GOTO30900
30500 IFM3$="+"THEN30600:ELSEW5=ASC(M3$)-192:GOTO30900
30600 O$=T$(80):GOSUB4:W5=1:OPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth"
30700 RECORD#2,W5:O$=".":GOSUB9:SYS8222:SYS8222:SYS8222:IFI$="{pound}"THENO$=R$:GOSUB9:CLOSE2:GOTO30900:ELSEW5=W5+1:IFW5<21THEN30700
30800 CLOSE2:O$=T$(81):GOSUB4:GOTO920
30900 GOSUB990:M4$=M3$:IFASC(M3$)<193THEN920
31000 OPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth":RECORD#2,W5:INPUT#2,U:INPUT#2,D:SYS8222:W5$=I$:SYS8222:W6$=I$:CLOSE2:IFW5$="{pound}"THENW5$="VOTE{sh space}TOPIC"
31100 IFMID$(U$(7),ASC(M4$)-192,1)="0"THEN31400:ELSEO$="{ct k}{black}Device      ("+STR$(U)+" ): {ct c}":GOSUB4:GOSUB10:IFI<8ORI>20THEN31200:ELSEU=I
31200 O$="{black}Drive       ("+STR$(D)+" ): {ct c}":GOSUB4:GOSUB10:IFI$=""THEN31300:ELSEIFI<0ORI>9THEN31300:ELSED=I
31300 O$="{black}Access : {white}ABCDEFGHIJKLMNOPQRSTUVWXYZ{ct k}       : "+W6$+R$+"   New : {ct c}":GOSUB4:X=26:GOSUB5:IFLEN(I$)=26THENW6$=I$
31400 FORI=1TO100:TT$(I)="":NEXT:A=FRE(1):O$="{ct k}{black}Enter topic ("+W5$+"){ct k}: {ct c}":GOSUB4:X=20:GOSUB5:IFI$<>""THENW5$=I$
31500 O$="{ct k}{black}Working...{ct c}":GOSUB4:OPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth":RECORD#2,W5:PRINT#2,STR$(U)+R$+STR$(D)+R$+W5$+R$+W6$:CLOSE2
31600 O$="{ct c}":OPEN2,U,2,STR$(D)+":vote.topic "+CHR$(W5+64)+",s,r":OPEN1,U,15:INPUT#1,I:W1=1:IFI>20THENCLOSE2:CLOSE1:O$="New topic!":GOTO31800
31700 INPUT#2,W1:FORI=1TOW1:INPUT#2,TT$(I),TT$(I+50):NEXTI:CLOSE2:CLOSE1
31800 GOSUB4:O$="{ct k}{black}Number of options ( "+STR$(W1)+"): {ct c}":GOSUB4:GOSUB10:IFI$=""THEN31900:ELSEIFI>20ORI=0THENO$="{ct k}{black}Try again!":GOTO31800:ELSEW1=I
31900 FORA=1TOW1
32000 O$="{ct k}{black}("+TT$(A)+"){ct k}{black}Letter to choose option #"+STR$(A)+": {ct c}":GOSUB4:X=1:GOSUB5:IFI$=""ANDTT$(A)=""THEN32000:ELSEIFI$<>""THENTT$(A)=I$
32100 O$="{black}("+TT$(A+50)+"){ct k}{black}Description for #"+STR$(A)+"{ct k}: {ct c}":GOSUB4:POKE2847,30:POKE2895,1:GOSUB6:IFI$=""ANDTT$(A+50)=""THEN32100:ELSEIFI$<>""THENTT$(A+50)=I$
32200 NEXTA:O$=T$(82):GOSUB4:OPEN1,U,15,"s"+STR$(D)+":vote.topic "+CHR$(W5+64):OPEN2,U,2,STR$(D)+":vote.topic "+CHR$(W5+64)+",s,w"
32300 PRINT#2,W1:FORA=1TOW1:PRINT#2,TT$(A):PRINT#2,TT$(A+50):NEXTA:CLOSE2:CLOSE1:O$=T$(83):GOSUB4:C$=R$:GOSUB28
32400 F$="vote.text "+CHR$(W5+64):O(12)=0:GOSUB8330:O(8)=23:O(12)=1:GOSUB1010:GOTO940
32500 GOSUB990:IFM3$<>"*"THENW5=ASC(M3$)-192:GOTO32600:ELSEGOSUB30100:W5=I:IFI=0THEN920
32600 O$="{ct k}{black}Delete vote topic "+CHR$(W5+192)+" (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:O$=A$:GOSUB4:IFI=2THEN920:ELSEOPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth"
32700 RECORD#2,W5:INPUT#2,U:INPUT#2,D:SYS8222:SYS8222:W6$=I$:RECORD#2,W5:PRINT#2,STR$(U)+R$+STR$(D)+R$+"{pound}"+R$+W6$:CLOSE2
32800 OPEN1,U,15,"s"+STR$(D)+":vote.topic "+CHR$(W5+64):PRINT#1,"s"+STR$(D)+":vote.text "+CHR$(W5+64):CLOSE1:GOTO940
32900 GOSUB990:IFM3$<>"*"THENW5=ASC(M3$)-192:GOTO33000:ELSEGOSUB30100:W5=I:IFI=0THEN920
33000 O$="{ct k}{black}Reset vote results "+CHR$(W5+192)+" (y/n)? {ct c}":GOSUB4:C$="YN":GOSUB28:O$=A$:GOSUB4:IFI=2THEN920
33100 OPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth":RECORD#2,W5:INPUT#2,U:INPUT#2,D:SYS8222:CLOSE2:IFI$="{pound}"THEN33400
33200 OPEN1,U,15,"s"+STR$(D)+":sys.work":PRINT#1,"r"+STR$(D)+":sys.work=vote.topic "+CHR$(64+W5):INPUT#1,I:IFI>20THENCLOSE1:GOTO33400
33300 OPEN2,U,2,STR$(D)+":sys.work,s,r":OPEN3,U,3,STR$(D)+":vote.topic "+CHR$(64+W5)+",s,w":GOSUB31:CLOSE3:CLOSE2:PRINT#1,"s"+STR$(D)+":sys.work":CLOSE1
33400 O$="{ct k}{black}Done.":GOSUB4:GOTO940
33500 GOSUB990:IFM3$<>"*"THENW5=ASC(M3$)-192:GOTO33600:ELSEGOSUB30100:W5=I:IFI=0THEN920
33600 W1=0:W2=0:FORA=0TO50:TT$(A)="":TT$(A+50)="":MR(A)=0:NEXTA:A=FRE(1)
33700 OPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth":RECORD#2,W5:INPUT#2,U:INPUT#2,D:SYS8222:W5$=I$:SYS8222:W6$=I$:CLOSE2
33800 IFW5$="{pound}"ORMID$(W6$,ASC(U$(5))-192,1)="0"THEN920:ELSEO$="{ct k}{black}"+W5$+"{ct k*2}":O$="{clear}{ct k}{black}"+W5$+"{ct k}":GOSUB4:F$="vote.text "+CHR$(64+W5):GOSUB26
33900 O$=T$(84):GOSUB4:OPEN1,U,15:OPEN2,U,2,STR$(D)+":vote.topic "+CHR$(64+W5)+",s,r":INPUT#1,I:IFI>20THENCLOSE2:CLOSE1:GOTO920
34000 INPUT#2,W3:FORI=1TOW3:SYS8222:TT$(I)=I$:SYS8222:TT$(I+50)=I$:NEXTI:CLOSE2:CLOSE1
34100 E=0:OPEN2,U,2,STR$(D)+":vote.topic "+CHR$(64+W5)+",s,r":SYS8213:IFPEEK(253)THENE=1:GOTO34400
34200 DO:SYS8222:IFI$=""THENEXIT:ELSEW1=W1+1:MR(VAL(I$))=MR(VAL(I$))+1:SYS8222:IFSTR$(ID)=I$ORSTR$(ID)+" "=I$THENW2=1
34300 LOOPUNTILPEEK(253)
34400 CLOSE2:IFW2=1THEN34800:ELSEO$="{ct k}":GOSUB4:C$="":FORI=1TOW3:O$="{black}"+TT$(I)+") "+TT$(I+50):C$=C$+TT$(I):GOSUB4:NEXTI:C$=R$+C$
34500 O$=T$(85):GOSUB4:GOSUB28:O$=A$:GOSUB4:IFI=1THEN920:ELSEO$=T$(86):GOSUB4:W1=W1+1:MR(I-1)=MR(I-1)+1
34600 OPEN2,U,2,STR$(D)+":vote.topic "+CHR$(W5+64)+",s,a":IFE=1THENPRINT#2,CHR$(1)
34700 PRINT#2,STR$(I-1):PRINT#2,STR$(ID):CLOSE2
34800 O$="{ct k}{black}{ct k}Results out of"+STR$(W1)+" vote(s).{ct k}":GOSUB4:FORI=1TOW3:O$="{black}"+RIGHT$(" "+STR$(MR(I)),3)+" ("+RIGHT$(" "+STR$(INT(MR(I)/W1*100)),3)
34900 O$=O$+"%): "+TT$(I+50):GOSUB4:NEXTI:O$="{ct k}{black}RETURN>{ct c}":GOSUB4:C$=R$:GOSUB28:O$=A$:GOSUB4:GOTO940
35000 GOSUB35100:GOTO940
35100 OPEN2,D(1,0),2,STR$(D(1,1))+":sys.voting booth":O$=R$:GOSUB9:C$="":W3$="":X=0:DO:X=X+1:RECORD#2,X:SYS8222:SYS8222:SYS8222:W1$=I$:SYS8222:W2$=I$
35200 O$="{ct c}":IFMID$(W2$,ASC(U$(5))-192,1)="1"ANDW1$<>"{pound}"THENO$="{black}"+CHR$(192+X)+") "+W1$
35300 GOSUB4:GOSUB8:LOOPUNTILX=20ORA$=" ":CLOSE2:RETURN
55555 OPEN1,8,15,"s0:prg.voting booth":CLOSE1:DSAVE"prg.voting booth":END
