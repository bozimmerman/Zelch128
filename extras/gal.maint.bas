!--------------------------------------------------
!- Saturday, May 20, 2017 1:34:30 AM
!- Import of : 
!- c:\src\zelch128\extras\gal.maint.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
10 U1=PEEK(186):ND=15:R$=CHR$(13):GOTO170
20 PRINT#1,"p"CHR$(98)CHR$(I)CHR$(0)CHR$(0):RETURN
30 OPEN1,U1,15:OPEN2,U1,2,"0:gal.galaxy":A$=""
40 EM$(RD,1)=DT$:FORI=1TO10:A$="":GOSUB20:FORX=0TO4:A$=A$+EM$(I,X)+R$:NEXTX
50 PRINT#2,A$;:NEXTI:FORI=11TO35:A$=PL$(I-10)+R$:GOSUB20:FORX=0TO4
60 A$=A$+STR$(PL(I-10,X))+R$
70 NEXTX:PRINT#2,A$;:NEXTI:CLOSE2:OPEN2,U1,2,"0:gal.missions":I=1:X=1
80 IFMS(X,0)=0THEN100
90 GOSUB20:A$="":FORY=0TO5:A$=A$+STR$(MS(X,Y))+R$:NEXTY:PRINT#2,A$;:I=I+1
100 X=X+1:IFX<101THEN80
110 GOSUB20:PRINT#2,"0"
120 CLOSE2:CLOSE1:PRINTR$:END
130 FORB=0TO5:MS(A,B)=0:NEXTB:RETURN
140 REM********************************
150 REM**********READ IN DATA FOR MAINT
160 REM********************************
170 DIMGX(35,20),PL$(25),PL(25,4),EM$(10,4),RD,TL(20,4),G2(35,20),MS(201,5)
180 TT=1
190 OPEN1,U1,15:OPEN2,U1,2,"0:gal.galaxy"
200 FORI=1TO10:GOSUB20:FORX=0TO4:INPUT#2,EM$(I,X):NEXTX:NEXTI
210 FORI=11TO35:GOSUB20:X=I-10
220 INPUT#2,PL$(X):FORY=0TO4:INPUT#2,PL(X,Y):NEXTY
230 NEXTI:I=36:GOSUB20:INPUT#2,ID,DT$:V1=0
240 CLOSE2:CLOSE1:OPEN1,U1,15:OPEN2,U1,2,"0:gal.missions":I=1
250 GOSUB20:INPUT#2,A:IFA=0ORI>199THENCLOSE2:CLOSE1:GOTO270
260 MS(I,0)=A:FORY=1TO5:INPUT#2,MS(I,Y):NEXTY:I=I+1:GOTO250
270 FORI=1TO25:GX(PL(I,1),PL(I,2))=PL(I,0):G2(PL(I,1),PL(I,2))=I
280 NEXTI:RD=0:FORI=1TO10:IFID=VAL(EM$(I,0))THENRD=I
290 NEXTI:GOTO330
300 REM******************************
310 REM********PERFORM MAINTENANCE
320 REM******************************
330 PRINT"{light green}Galactic weed..."
340 W2=VAL(MID$(DT$,4,2)):W3=VAL(MID$(DT$,1,2)):W4=VAL(MID$(DT$,7,2))
350 FORI=1TOND
360 W2=W2-1:IFW2<1THENW3=W3-1:W2=30:IFW3<1THENW3=12:W2=31:W4=W4-1
370 IFW4<0THENW4=99
380 NEXTI:W1$=RIGHT$(STR$(W4),2)+RIGHT$(STR$(W3),2)+RIGHT$(STR$(W2),2)
390 FORI=1TOLEN(W1$)
400 IFMID$(W1$,I,1)=" "THENW1$=LEFT$(W1$,I-1)+"0"+MID$(W1$,I+1,LEN(W1$))
410 NEXTI
420 E=0:FORI=1TO10:W0$=EM$(I,1):W2$=MID$(W0$,7,2)+MID$(W0$,1,2)+MID$(W0$,4,2)
430 IFVAL(EM$(I,0))=0THEN460
440 IFW2$>W1$THEN500
450 E=E+1:EM$(I,0)=" 0":EM$(I,1)="91/01/01":EM$(I,2)="^":EM$(I,3)=" -26"
460 EM$(I,4)="0":FORX=1TO25:IFPL(X,0)=ITHENPL(X,0)=-1:GX(PL(X,1),PL(X,2))=-1
470 NEXTX:OPEN1,U1,15,"s0:gal.spy."+STR$(I):CLOSE1
480 FORA=1TO200:IFMS(A,0)THENIFMS(A,4)=IORMS(A,5)=ITHENGOSUB130
490 NEXTA
500 NEXTI:RD=0:IFETHEN30
128 
