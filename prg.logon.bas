!--------------------------------------------------
!- Monday, May 15, 2017 3:02:22 AM
!- Import of : 
!- c:\src\zelch128\prg.logon.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM =============== LOGON MODULE V1.0 =============== 09/22/90 =
30010 ID=0:SYS15634:CLR:SYS15637:IFO(15)THENGOSUB35400:O$="{ct c}":GOTO34500:ELSEI=M(9):GOSUB450:CLOSE5:OPEN5,2,0,CHR$(PEEK(2576))
30015 GOSUB13:IFM(0)>2THEN30020:ELSEPRINT#5,R$R$R$:A$=O$(14):GOSUB2
30020 IFW1=408THENW1=0:GOTO35700
30200 POKE2822,0:POKE2823,1:POKE2824,0:POKE2825,0:POKE2827,0:POKE2829,0:POKE2830,0:POKE2831,0:POKE2844,0:POKE2845,1:POKE2850,1:POKE2953,0:POKE2954,0:POKE2958,0
30300 POKE2895,0:POKE2896,0:POKE2915,0:POKE2917,0:POKE2603,8:POKE2925,M(3):FORI=7TO15:O(I)=0:NEXTI:FORI=0TO26:PL(I)=0:NEXTI:POKE2959,1:POKE2974,0:POKE2979,0
30400 O$="Waiting for call":GOSUB250:GOSUB300:TRAP360
30500 PRINT"{clear}";:WINDOW0,4,29,15:PRINTCHR$(27)"f";:PRINTR$"{clear}{light gray}{reverse on}{ct n}{cm t*29}":O$="{reverse on}                             "+R$+"{up}{reverse on} "
30600 PRINTO$TAB(13-(INT(LEN(N$)/2)))LEFT$(N$,27):PRINTO$R$O$R$O$R$O$"Total calls"TAB(20)":"O(4)
30700 PRINTO$"Calls since boot"TAB(20)":"O(0):PRINTO$"Number of feedback"TAB(20)":"O(2):P0=1:O(1)=0:O(7)=0:O(9)=0
30800 PRINTO$"Logged errors"TAB(20)":"O(5):PRINTO$"New users"TAB(20)":"O(6):PRINT"{reverse on}{cm @*29}":O(3)=0
30900 SYS8216:PRINT"{home}{down*3}{right}{reverse on}"MID$("JanFebMarAprMayJunJulAugSepOctNovDec",((PEEK(2879)-1)*3)+1,3)PEEK(2880)TAB(21)I$
31200 IFPEEK(2961)THENGOSUB35900:GOSUB36666:I$="prg.monster":U=D(0,0):D=D(0,1):GOTO23
31300 IF(PEEK(56577)AND8)=8ORM(0)<3THEN31600:ELSEI=0:GOSUB18
31400 IF(PEEK(56577)ANDM(4))=0THEN34100:ELSEIFI<11THENI=I+1:SLEEP1:GOTO31400
31500 GOSUB13
31600 GETA$:IFA$=CHR$(27)THENX=1:GOTO32000
31602 IFA$="{ct c}"THENGOSUB35900:I$="prg.misc":U=D(0,0):D=D(0,1):W1=9E9:GOTO23
31605 IFA$="{ct x}"THENPRINTCHR$(27)"x":WINDOW0,4,PEEK(238),23,1:PRINT"{down}{home}":SLOW:IFPEEK(215)THENFAST:GOTO30400:ELSEIFA$="{ct x}"THEN30400
31610 IF(PEEK(211)AND8)THENO(16)=ABS(O(16)-1):IFO(16)=0THENGOSUB35900
31620 IFO(16)ANDO(3)=0THENGOSUB35800
31630 IFA$=" "THENO(3)=1:TI$="000000":GOSUB35900
31640 IFO(3)ANDVAL(TI$)>10THENO(3)=0
31700 GET#5,A$:IFA$=""THEN30900:ELSEA=ASC(A$)AND127:IFA<>49THEN31800:ELSEGET#5,A$:IF(ASC(A$)AND127)=48THENI=2400:GOSUB450:GOTO34100:ELSEI=300:GOSUB450:GOTO34100
31800 IFA=53THENI=1200:GOSUB450:GOTO34100:ELSEIFA=50ANDINSTR(O$(14),"s0=0")THENSLEEP1:PRINT#5,"ata"
31900 GOTO30900
32000 GOSUB35900:A=PEEK(238)-34:POKE2829,1:POKE2845,0:WINDOWA,9,A+22,23:Y=1:X=1:GOSUB32100:GOTO32800
32100 TT$(0)="{cm m}{reverse on} Local Mode Options {reverse off}{cm g}":TT$(1)=" Local logon        ":TT$(2)=" SysOp logon        ":TT$(3)=" Zapterm            "
32200 TT$(4)=" Read feedback      ":TT$(5)=" View caller log    ":TT$(6)=" Check errorlog     ":TT$(7)=" New user apps      ":TT$(8)=" SysOp utility menu "
32300 PRINT"{clear} {cm @*20} ":PRINT"{cm m}{reverse on}                    {reverse off}{cm g}":PRINTTT$(0):PRINT"{cm m}{reverse on}                    {reverse off}{cm g}"
32400 FORI=1TO8:A$=TT$(I):GOSUB32600:NEXT:PRINT"{cm m}{reverse on}                    {reverse off}{cm g}":PRINT"{reverse off} {cm t*20}":RETURN
32500 PRINTLEFT$("{home}{down*11}",Y+4);
32600 I$="{reverse on}"+CHR$(PEEK(2835+X)):IFY<>XTHENI$="{reverse on}{light gray}"
32700 Y=Y+1:PRINT"{reverse off}{light gray}{cm m}"I$A$"{reverse off}{light gray}{cm g}":RETURN
32800 ID=0:A=0:X=1:DOUNTILA$=CHR$(13):GETA$:IFA$="{up}"THENA=X:X=X-1:IFX=0THENX=8
32900 IFA$="{down}"THENA=X:X=X+1:IFX=9THENX=1
33000 IFA$="{down}"ORA$="{up}"THENY=A:A$=TT$(A):GOSUB32500:Y=X:A$=TT$(X):GOSUB32500:ELSEIFA$=CHR$(27)THENEXIT
33100 LOOP:IFA$=CHR$(27)ANDPEEK(215)THENPRINT"{home}"SP$SP$SP$SP$:WINDOW0,4,29,15:PRINT:GOTO30900:ELSEIFA$=CHR$(27)THEN30500
33200 GOSUB36666:U=D(1,0):D=D(1,1):POKE2823,1:IFX=1THENBA=9600:GOSUB35300:GOTO34200:ELSEIFX=2THENI=1:BA=9600:GOSUB35300:GOTO35100
33300 IFX=3THENU=D(0,0):D=D(0,1):I$="prg.zapterm":GOTO23:ELSEIFX=8THENI=1:E=1:BA=9600:GOSUB35300:POKE2915,SGN(PEEK(215)):GOTO35100
33400 IFX=4THEN35500:ELSEIFX=5THENF$="sys.userlog":ELSEIFX=6THENF$="sys.errorlog":ELSEW1=408:I$="prg.sysop":U=D(0,0):D=D(0,1):GOSUB35300:POKE2825,255:GOTO23
33500 POKE2825,255:POKE2824,1:POKE2827,0:OPEN1,U,15:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,r":PRINT"{clear}{ct n}";:INPUT#1,I:IFITHENCLOSE2:GOTO33700
33600 SYS8210:IFPEEK(255)=0THEN33650:ELSEPRINT"{ct n}"+CHR$(13)+"RETURN>";:DO:GETKEYA$:LOOPUNTILA$=CHR$(13):GOTO33600
33650 CLOSE2:PRINT"DELETE{sh space}(Y/N)? ";:C$="YN":GOSUB28:PRINTA$:IFI=2THENCLOSE1:GOTO30200
33700 PRINT#1,"s"+MID$(STR$(D),2)+":"+F$:CLOSE1:IFMID$(F$,10)="log"ANDO(5)THENO(5)=0:GOTO35700
33800 IFMID$(F$,9)="user"ANDO(6)THENO(6)=0:GOTO35700:ELSE30200
34100 POKE2973,3:POKE2979,0:POKE2974,3:POKE2823,0:GOSUB35300:SYS8216:O$="Connect:"+STR$(BA)+" baud   /   On at: "+I$:GOSUB250:POKE2845,1
34200 SLEEP1:FORI=0TO50:GET#5,A$:NEXTI:PRINTO$(21);
34250 O$=T$(35):GOSUB4:C$=R$+CHR$(10)+"Z":GOSUB28:IFI=3THENI$="prg.network":U=D(0,0):D=D(0,1):W1=9E9:GOTO23:ELSEO$=T$(36):GOSUB4
34300 O$=T$(21):POKE2829,1:DO:GOSUB8:LOOPUNTILA$>""ANDA$<>CHR$(13):IFA$=CHR$(20)THENPOKE2845,0:O$=T$(21):GOTO34500:ELSEPOKE2829,0:O$=T$(22):GOSUB4
34400 O$=T$(37):GOSUB4:C$="NY"+R$:GOSUB28:O$=A$:GOSUB4:POKE2845,SGN(I-1):O$=T$(23):IFI=1THENO$=T$(24):GOSUB4:ELSEGOSUB4
34410 O$=T$(94):GOSUB4:C$=R$+"NY":GOSUB28:O$=A$:GOSUB4:O$=T$(92):IFI=3THENO$=T$(93):POKE2979,1
34500 GOSUB4:POKE2825,4:U=D(1,0):D=D(1,1):A$="":IFM(16+PEEK(2829))>1THENA$=STR$(INT(RND(TI)*(M(PEEK(2829)+16))+1))
34590 F$="sys.title"+A$:IFPEEK(2829)=0THENF$=F$+"/a":GOSUB25:ELSEGOSUB25
34600 ID=0:O$=T$(38):GOSUB4:POKE2831,1:POKE2895,1:POKE2847,16:GOSUB10:IFI$="NEW"THEN34800:ELSEIFI>0ANDI<501THEN34900
34700 IFI$<>""THENX=0:DO:X=X+1:LOOPUNTIL(UI$(X)="")OR(X>M(14))OR(UI$(X)=I$):IFUI$(X)=I$THENI=X:GOTO34900
34800 O$=T$(39):GOSUB4:C$="YN":GOSUB28:O$=A$:GOSUB4:IFI=1THENI$="prg.new user":U=D(0,0):D=D(0,1):POKE2973,5:POKE2974,5:GOTO23:ELSE34600
34900 E=0:IFUI$(I)=""ORUI$(I)="^"THEN34700:ELSEO$=T$(40):GOSUB4:POKE2844,1:X=10:GOSUB5:IFI$=""THEN34600
35000 O$=I$:OPEN2,D(4,0),2,MID$(STR$(D(4,1)),2)+":sys.userfiles":RECORD#2,I:SYS8222:SYS8222:CLOSE2:IFI$<>O$THENO$=T$(41):GOSUB4:GOTO34600
35100 ID=I:O$=T$(42):GOSUB4:OPEN2,D(4,0),2,MID$(STR$(D(4,1)),2)+":sys.userfiles":RECORD#2,ID:FORI=1TO6:SYS8222:U$(I)=I$:NEXTI
35150 GOSUB36000:U$(7)=I$:FORI=8TO9:INPUT#2,U$(I):NEXTI:GOSUB36000:U$(10)=I$
35200 FORI=1TO5:SYS8222:U(I)=ABS(VAL(I$)):NEXTI:CLOSE2:GOSUB400:U$(9)=STR$(VAL(U$(9))+1):POKE2959,VAL(MID$(U$(8),5,1)):POKE2915,VAL(MID$(U$(8),2,1))
35210 U=D(0,0):D=D(0,1):IFPEEK(2823)THENBLOAD"l-xfer 1300",U(U),D(D):O(19)=2:O$(23)="Local":GOTO35250:ELSEIFBA=2400THENPOKE2582,160+VAL(MID$(U$(8),9,1))
35220 A=VAL(MID$(U$(8),6,1)):IFA<>O(19)THENBLOAD(MID$("px",A+1,1)+"-xfer 1300"),U(U),D(D):O(19)=A:O$(23)="Punter":IFO(19)=1THENO$(23)="Xmodem"
35250 A=CD(ASC(U$(5))-192,2):POKE2973,A:POKE2974,A:IFE=0THEN2000:ELSEO$(15)=O$(20):POKE2825,255:GOTO8990
35300 POKE2603,0:ID=0:PRINTCHR$(27)"e{clear}{light gray}"CHR$(27)"s";:POKE2825,3:POKE2824,1:POKE2827,0:O(1)=0
35400 O(15)=0:O(3)=0:GOSUB35900:GOSUB36666:RETURN
35500 F0$="sys.feedback":U0=D(6,0):D0=D(6,1):GOSUB35300:POKE2823,1:POKE2825,255:OPEN1,U0,15,"s"+MID$(STR$(D0),2)+":mail.work":CLOSE1:POKE2915,SGN(PEEK(215))
35600 PRINT"{clear}{ct n}";:U$(1)=UI$(1):ID=1:GOSUB8130:O(2)=W7:IFO(2)<0THENO(2)=0
35700 OPEN2,D(4,0),2,MID$(STR$(D(4,1)),2)+":sys.misc data":RECORD#2,1:A$="":FORI=2TO6:A$=A$+STR$(O(I))+R$:NEXTI:PRINT#2,A$+O$(12):CLOSE2:POKE2915,0:GOTO30200
35800 SYS52684,1,34:SYS52684,1,35:FAST:RETURN
35900 SYS52684,125,34:SYS52684,100,35:IFPEEK(215)THENRETURN:ELSESLOW:RETURN
36000 I$="":FORI=1TO4:GET#2,A$:FORX=0TO7:I$=I$+MID$(STR$(SGN(ASC(A$)AND2^X)),2):NEXTX:NEXTI:I$=LEFT$(I$,26):RETURN
36666 WINDOW0,4,PEEK(238),23:RETURN
36667 GOSUB36666:PRINTCHR$(27)"s{clear}":LIST32000-
55555 A=PEEK(186):OPEN1,A,15,"s0:prg.logon":CLOSE1:SAVE"prg.logon",A
