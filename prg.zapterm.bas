!--------------------------------------------------
!- Monday, May 15, 2017 3:04:20 AM
!- Import of : 
!- c:\src\zelch128\prg.zapterm.prg
!- Commodore 128 BASIC 7/7.1
!--------------------------------------------------
30000 SYS15625:REM =============== ZAPTERM MODULE V1.0 ============ 07/24/91 =
30005 O$(23)="Punter":IFO(19)THENBLOAD"p-xfer 1300",U(D(0,0)),D(D(0,1)):O(19)=0
30010 U=8:D=0:POKE2823,1:POKE2829,1:POKE2845,0:POKE2974,0:I=M(9):GOSUB450:IF(PEEK(56577)ANDM(4))<>PEEK(2853)ORM(0)>2THEN30015:ELSEGOSUB29:A$=O$(18):GOSUB2
30015 GOSUB30050:GOTO30030
30030 O$="Zapterm Version 2.0":GOSUB250:GOTO31000
30040 OPEN2,D(4,0),2,MID$(STR$(D(4,1)),2)+":sys.misc data":RETURN
30050 GOSUB30040:RECORD#2,3:FORI=1TO8:SYS8222:KEYI,I$:NEXTI:FORI=4TO23:RECORD#2,I:FORY=0TO4:SYS8222:PH$(I-3,Y)=I$:NEXTY:NEXTI:CLOSE2:RETURN
30900 POKE2825,255:POKE2824,1:POKE2827,0:POKE2830,1:POKE2850,0:POKE2603,0:RETURN
31000 TRAP360:POKE2603,0:PRINTCHR$(27)"l"CHR$(27)"f{pink}{clear}{down}{ct n}Z{yellow}e{white}l{cyan}c{light blue}h {white}ZAPTERM v2.0":GOSUB30900
31010 PRINT"{down}{white}{reverse on}ESC{reverse off} {yellow}TERMINAL{sh space}MODE"TAB(20)"{reverse on}{white} A {reverse off} {yellow}AUTO DIALER"TAB(40)"{reverse on}{white} Q {reverse off} {yellow}QUIT{sh space}TO{sh space}BBS"SPC(5)"{white}{reverse on} B {reverse off} {yellow}BAUD{sh space}CHANGE"
31020 PRINT"{white}{reverse on} D {reverse off} {yellow}DOWNLOAD{sh space}FILE"TAB(20)"{reverse on}{white} U {reverse off} {yellow}UPLOAD FILE"TAB(40)"{reverse on}{white} $ {reverse off} {yellow}DIRECTORY"SPC(7)"{reverse on}{white} @ {reverse off} {yellow}DOS{sh space}CHANNEL"
31030 PRINT"{reverse on}{white} P {reverse off} {yellow}PICKUP PHONE"TAB(20)"{reverse on}{white} H {reverse off} {yellow}HANGUP{sh space}LINE"TAB(40)"{reverse on}{white} # {reverse off} {yellow}CHANGE DRIVES"SPC(3)"{reverse on}{white} X {reverse off} {yellow}XFER PROTOCOLS"
31035 PRINT"{reverse on}{white} F {reverse off} {yellow}FILEDUMP"TAB(20)"{reverse on}{white} ! {reverse off} {yellow}SEQ READER"TAB(40)"{reverse on}{white} E {reverse off} {yellow}EDIT FKEYS"SPC(6)"{reverse on}{white} M {reverse off} {yellow}MESSAGE MAKER"
31040 PRINT"{down}{white}BAUD:{yellow}"BA;TAB(20)"{white}DRIVE:{yellow}"U"{left},"+MID$(STR$(D),2);TAB(40)"{white}PROTOCOL:{yellow} "O$(23):PRINT"{down}{yellow}ZAP{white}> <{left*2}"CHR$(27)"s"CHR$(27)"f";
31045 C$=CHR$(27)+"qbdu$@ph#xaf!em":GOSUB28:PRINT"{yellow}"A$"{white}>";
31050 ONIGOTO31500,31600,32000,33000,34000,35000,36000,37000,38000,39000,41000,42000,44000,45000,46000,47000
31500 O$="Terminal Mode":GOSUB250:POKE2603,0:PRINTCHR$(27)"l"CHR$(27)"f{white}{ct n}":SYS8231:GOTO30030
31600 POKE2830,0:GOSUB30040:RECORD#2,2:A$="":FORI=1TO10:SYS8222:A$=A$+I$:POKE4095+I,LEN(I$):NEXTI:CLOSE2
31650 FORI=1TOLEN(A$):A=ASC(MID$(A$,I,1)):IFA=11THENA=13
31660 POKE4105+I,A:NEXTI:FORI=1TO20:FORY=0TO4:PH$(I,Y)="":NEXTY:NEXTI:U=D(0,0):D=D(0,1):I$="prg.logon":GOTO23NOTYET!
31700 POKE2895,1:POKE2847,16:PRINT"{yellow}FILENAME: {white}";:GOSUB6:IFI$=""THENX=1:RETURN:ELSEFORI=1TO6:IFINSTR(I$,MID$("@*:?$;",I,1))THENX=1
31705 NEXTI:F$=I$:A$="":IFY=9E9THENY=0:RETURN
31710 PRINT"{yellow}P)RG, S)EQ, or W)RP {white}: ";:DO:GOSUB8:LOOPUNTILINSTR("psw"+R$,A$):I=INSTR("psw"+R$,A$):PRINTA$:IFI=4THENX=1:RETURN:ELSERETURN
32000 POKE2895,1:POKE2847,4:PRINT"{yellow}NEW{sh space}BAUD ({white}"+MID$(STR$(BA),2)+"{yellow}) : ";:GOSUB10:IFI=1200THENGOSUB450:ELSEIFI=2400THENGOSUB450
32010 IFI<600ANDI>150THENGOSUB450:GOTO31000:ELSE31000
33000 X=0:GOSUB31700:IFX=1THEN31000:ELSEPRINT"{clear}{white}DOWNLOAD:{yellow} "F$","A$:GOSUB500:SLEEP5:GOTO31500
34000 X=0:GOSUB31700:IFX=1THEN31000:ELSEPRINT"{clear}{white}UPLOAD:{yellow} "F$","A$:GOSUB550:GOTO31500
35000 POKE2895,1:POKE2847,16:PRINT"{yellow}FILEMASK ({white}*{yellow}) : ";:GOSUB6:IFI$=""THENI$="*"
35010 POKE253,0:PRINT"{white}":OPEN1,U,15:OPEN2,U,0,"$"+MID$(STR$(D),2)+":"+I$:INPUT#1,A:IFA>0THENPRINT"Drive error":ELSESYS8219
35020 CLOSE1:CLOSE2:PRINT:PRINT"{white}HIT{sh space}RETURN>";:DOUNTILA$=CHR$(13):GETKEYA$:LOOP:GOTO31000
36000 POKE2895,0:GOSUB6:IFI$=""THEN36010:ELSEOPEN1,U,15,I$:CLOSE1
36010 OPEN1,U,15:INPUT#1,I,I$,X,Y:PRINT"{yellow}STATUS:{white}"I","I$","X","Y:CLOSE1:PRINT"{down}{white}HIT{sh space}RETURN>";:DOUNTILA$=CHR$(13):GETKEYA$:LOOP:GOTO31000
37000 GOSUB18:GOTO31000
38000 GOSUB13:GOTO31000
39000 POKE2895,1:POKE2847,2:PRINT"{yellow}DEVICE{sh space}(8-30) :{white} ";:GOSUB10:IFI<8ORI>30THEN31000
39005 U=I:PRINT"{yellow}{up}{right*6}DRIVE (0-254):{white} "CHR$(27)"q";:GOSUB10:IFI<0ORI>254THEN31000
39010 D=I:GOTO31000
41000 O(19)=ABS(O(19)-1):O$(23)="Punter":IFO(19)THENO$(23)="Xmodem"
41010 BLOAD(MID$("px",O(19)+1,1)+"-xfer 1300"),U(D(0,0)),D(D(0,1))
41020 GOTO31000
42000 O$="Dialer [<ESC>,L,U,S,E]":GOSUB250:GOSUB30900:POKE2603,8:PRINTCHR$(27)"e"CHR$(27)"m{clear}{cyan}";:O$(8)="Ascii":O$(9)="Color":O$(15)="Off":O$(16)="On"
42005 O$="   ####################  #############":IFPEEK(215)THENO$=O$+"#####  ####    #####    Linefeeds ###"
42006 FORX=1TO20
42007 IFPEEK(215)=0THENPRINTUSINGO$;PH$(X,0),PH$(X,1)
42008 IFPEEK(215)THENPRINTUSINGO$;PH$(X,0),PH$(X,1),VAL(LEFT$(PH$(X,2),1))*300,O$(8+VAL(MID$(PH$(X,2),2,1))),O$(15+VAL(MID$(PH$(X,2),3,1)))
42010 NEXTX:X=1:PRINT"{home}{white}->{left*2}";
42020 GETKEYA$:ONINSTR("{down}-{up}+",A$)GOTO42040,42040,42060,42060
42030 ONINSTR(CHR$(27)+"sleu"+R$,CHR$(ASC(A$)AND127))GOTO30030,42100,42200,42300,43400,43100
42040 PRINT"  {left*2}";:X=X+1:IFX>20THENX=1:PRINT"{home}";:ELSEPRINT
42050 PRINT"->{left*2}";:GOTO42020
42060 PRINT"  {left*2}";:X=X-1:IFX<1THENX=20:PRINT"{down*19}";:ELSEPRINT"{up}";
42070 GOTO42050
42100 O$="Saving...":GOSUB250
42110 GOSUB30040:FORI=4TO23:RECORD#2,I:A$="":FORY=0TO4:A$=A$+PH$(I-3,Y)+R$:NEXTY:PRINT#2,A$;:NEXTI:CLOSE2:GOTO42000
42200 O$="Loading...":GOSUB250
42210 GOSUB30040:FORI=4TO23:RECORD#2,I:FORY=0TO4:SYS8222:PH$(I-3,Y)=I$:NEXTY:NEXTI:CLOSE2:GOTO42000
42300 I=X:O$="Edit [A,B,C,D,E,F,G]":GOSUB250:X=I
42305 PRINT"{cyan}{clear}{down}Edit Phonebook Entry":PRINT"{down}{reverse on}{white} A {reverse off} {yellow}SYSTEM NAME : {cyan}"PH$(X,0)
42310 PRINT"{reverse on}{white} B {reverse off} {yellow}PHONE NUMBER: {cyan}"PH$(X,1):PRINT"{reverse on}{white} C {reverse off} {yellow}BAUD RATE   :{cyan}"VAL(LEFT$(PH$(X,2),1))*300
42320 PRINT"{reverse on}{white} D {reverse off} {yellow}GRAPHIC MODE: {cyan}";:IFMID$(PH$(X,2),2,1)="0"THENPRINT"Ascii":ELSEPRINT"Color"
42330 PRINT"{reverse on}{white} E {reverse off} {yellow}LINEFEEDS   : {cyan}";:IFMID$(PH$(X,2),3,1)="0"THENPRINT"Off":ELSEPRINT"On"
42350 PRINT"{reverse on}{white} F {reverse off} {yellow}HANDLE/ID   : {cyan}"PH$(X,3):PRINT"{reverse on}{white} G {reverse off} {yellow}PASSWORD    : {cyan}"PH$(X,4)
42370 POKE2603,0:PRINTCHR$(27)"f{down}{cyan}Edit Which? ";:GETKEYA$:PRINTA$
42380 ONINSTR("abcdefg",CHR$(ASC(A$)AND127))GOTO42400,42500,42600,42700,42800,42900,43000:GOTO42000
42400 POKE2895,1:POKE2847,20:PRINT"{down}{yellow}SYSTEM NAME: {white}";:GOSUB6:IFI$=""THEN42300:ELSEPH$(X,0)=I$:GOTO42300
42500 POKE2895,1:POKE2847,18:PRINT"{down}{yellow}PHONE NUMBER: {white}";:GOSUB6:IFI$=""THEN42300:ELSEPH$(X,1)=I$:GOTO42300
42600 POKE2895,1:POKE2847,4:PRINT"{down}{yellow}BAUD RATE: {white}";:GOSUB10:IFI=0THEN42300:ELSEMID$(PH$(X,2),1,1)=MID$(STR$(I/300),2,1):GOTO42300
42700 PRINT"{down}{yellow}COMMODORE GRAPHICS? ";:GETKEYA$:A$=CHR$(ASC(A$)AND127):IFINSTR("yn",A$)=0THEN42300
42710 MID$(PH$(X,2),2,1)=MID$(STR$(INSTR("ny",A$)-1),2):GOTO42300
42800 PRINT"{down}{yellow}LINEFEEDS (Y/N)? ";:GETKEYA$:A$=CHR$(ASC(A$)AND127):IFINSTR("yn",A$)=0THEN42300
42810 MID$(PH$(X,2),3,1)=MID$(STR$(INSTR("ny",A$)-1),2):GOTO42300
42900 POKE2895,1:POKE2847,20:PRINT"{down}{yellow}HANDLE/ID: {white}";:GOSUB6:IFI$=""THEN42300:ELSEPH$(X,3)=I$:GOTO42300
43000 POKE2895,1:POKE2847,20:PRINT"{down}{yellow}PASSWORD: {white}";:GOSUB6:IFI$=""THEN42300:ELSEPH$(X,4)=I$:GOTO42300
43100 POKE2603,0:PRINTCHR$(27)"f{cyan}{clear}{down}Now Dialing: {white}"PH$(X,0):PRINT"{cyan}    Phone #: {white}"PH$(X,1):PRINT"{cyan}     Status: {white}";:W9$=PH$(X,1)
43110 W7=X:I=VAL(LEFT$(PH$(X,2),1))*300:IFI=BATHEN43130
43115 IFI=1200THENGOSUB450:ELSEIFI=2400THENGOSUB450
43120 IFI<600ANDI>150THENGOSUB450
43130 X=W7:POKE2829,VAL(MID$(PH$(X,2),2,1)):POKE2845,VAL(MID$(PH$(X,2),3,1))
43131 W0=0:W1$="":FORI=1TO8:W0=W0+PEEK(4095+I):NEXTI:IFW0+LEN(PH$(X,4))<255THENPOKE4104,LEN(PH$(X,4)):W1$=PH$(X,4)
43134 IFW0+LEN(W1$)+LEN(PH$(X,3))<255THENPOKE4105,LEN(PH$(X,3)):W1$=W1$+PH$(X,3)
43136 IFW1$<>""THENFORI=1TOLEN(W1$):POKE4105+W0+I,ASC(MID$(W1$,I,1)):NEXTI
43140 PRINT#5,R$+R$:SLEEP2:TI$="000000":GETW1$:IFW1$=" "THEN42000
43142 GET#5,A$:IFA$<>""THEN43142
43145 PRINT#5,"atdt"+W9$:I$=""
43150 GET#5,A$:IFVAL(TI$)>20THENI$="6":GOTO43300
43155 GETW1$:IFW1$=" "THENPRINT#5,R$+R$:GOTO42000
43160 IFA$=""THEN43150
43170 IFA$=CHR$(13)THEN43300:ELSEI$=I$+A$:GOTO43150
43300 IFI$=""THEN43150:ELSEA$="":FORI=1TOLEN(I$):W2=ASC(MID$(I$,I,1))AND127:IFW2>31ANDW2<96THENA$=A$+CHR$(W2)
43305 NEXTI:I$=A$:IFI$=""THEN43150
43310 IFLEFT$(I$,7)="connect"THENPRINT"{home}{down*3}{right*13}"I$:SOUND1,65535,100,0,32768,3000,2,2600:GOTO31500
43320 A=VAL(I$):IFA=1ORA=5ORA=10THENI$="connection!":GOTO43310
43330 IFINSTR(I$,"dt")THENI$="":GOTO43150
43340 PRINT"{home}{down*3}{right*13}"I$CHR$(27)"q":SLEEP2:GOTO43140
43400 POKE2603,0:PRINTCHR$(27)"f{clear}{down}{cyan}Now Dialing: {white}Unlisted Entry":POKE2895,1:POKE2847,18:PRINT"{cyan}    Phone #: {white}";:GOSUB6:IFI$=""THEN42000
43500 PRINT"{cyan}     Status: {white}";:W9$=I$:GOTO43140
44000 Y=9E9:X=0:GOSUB31700:IFX=1THEN31000:ELSEOPEN1,U,15:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,r":INPUT#1,E:IFETHENCLOSE1:CLOSE2:GOTO31000
44005 SLOW:PRINT"{clear}{down}{white}Sending file...{cyan}{down}"
44010 SYS8222:IFI$=""THENI$=" "+R$:ELSEIFRIGHT$(I$,1)<>"{f7}"THENI$=I$+R$
44015 FORI=1TOLEN(I$):A$=MID$(I$,I,1):A=INSTR("{f7}{ct k}{f6}{black}{f5}",A$):IFATHENA$=MID$(" "+R$+R$+CHR$(0)+CHR$(34),A,1)
44020 PRINTA$;:IFPEEK(2829)=0THENA$=CHR$(PEEK(15360+ASC(A$+CHR$(0))))
44030 IFASC(A$+CHR$(0))=0THEN44050:ELSEPRINT#5,A$;:GET#5,A$
44050 NEXTI:IFPEEK(253)=0THEN44010
44060 IFPEEK(215)THENFAST
44070 CLOSE1:CLOSE2:DO:GET#5,A$:LOOPUNTILA$="":GOTO31000
45000 Y=9E9:X=0:GOSUB31700:IFX=1THEN31000:ELSEPRINT:OPEN1,U,15:OPEN2,U,2,MID$(STR$(D),2)+":"+F$+",s,r":SYS8210:CLOSE2:CLOSE1
45010 PRINT:PRINT"{ct n}Hit Return:";:DO:GETA$:LOOPUNTILA$=R$:GOTO31000
46000 PRINT:PRINT:KEY
46010 PRINT"{down}{yellow}EDIT{sh space}WHICH (1-8,S,L): {white}";:GETKEYA$:PRINTA$:IFA$="s"THEN46030:ELSEIFA$="l"THENGOSUB30050:GOTO46000
46015 TRAP 31000:IFVAL(A$)=0THEN31000
46020 PRINT"{down}{yellow}CHANGE{sh space}TO: {white}";:GOSUB6:IFI$=""THEN46000:ELSEKEY(VAL(A$)),I$:GOTO46000
46030 GOSUB30040:A$="":Y=0:FORI=1TO8:A=PEEK(4095+I):FORX=1TOA:A$=A$+CHR$(PEEK(4105+Y+X)):NEXTX:A$=A$+R$:Y=Y+A:NEXTI:RECORD#2,3:PRINT#2,A$:CLOSE2:GOTO46000
47000 Y=9E9:X=0:GOSUB31700:IFX=1THEN31000:ELSEO(12)=1:O(10)=0:GOSUB1000:GOTO31000
55555 A=PEEK(186):OPEN1,A,15,"s0:prg.zapterm":CLOSE1:DSAVE"prg.zapterm",U(A)
